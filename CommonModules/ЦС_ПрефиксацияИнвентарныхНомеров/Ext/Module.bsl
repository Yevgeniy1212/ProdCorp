//Получает инвентарный номер в зависимости от организации, указанной в документе принятия к учету
//Параметры:	<МассивОрганизаций> - массив организаций, где учет ведется в одной базе
//				<Организация>		- текущая организация
//				<ОС>				- Анализируемое основное средство
//				<ТаблицаОС>			- таблица с новыми активами
//				<Период>				- дата среза для регистра с инв. номерами
Функция ПолучитьИнвентарныйНомер(МассивОрганизаций, Организация, ОС, ТаблицаОС, Период) Экспорт
	
	Если МассивОрганизаций.Количество() = 0 тогда
		
		//Заполняем массив организаций, где учет ведется в одной базе
		Запрос = Новый Запрос;
		Запрос.Текст = 
		"ВЫБРАТЬ
		|	ЦС_ОрганизацииЦентральнойБазыДляОбщегоУчетаИнвентарныхНомеров.Организация
		|ИЗ
		|	РегистрСведений.ЦС_ОрганизацииЦентральнойБазыДляОбщегоУчетаИнвентарныхНомеров КАК ЦС_ОрганизацииЦентральнойБазыДляОбщегоУчетаИнвентарныхНомеров";
		
		МассивОрганизаций = Запрос.Выполнить().Выгрузить().ВыгрузитьКолонку("Организация");
		
	КонецЕсли;
	
	Если МассивОрганизаций.Найти(Организация)=Неопределено тогда
		
		//Организация находится не в этой базе. Можно смело присваивать инвентарный номер согласно кода
		Возврат ОС.Код;
	КонецЕсли; 	
	
	Если ТаблицаОС.Количество() = 0 тогда
		
		//Заполняем таблицу ОС и инв номеров по текущей организации	
		Запрос = Новый Запрос;
		Запрос.Текст = 
		"ВЫБРАТЬ
		|	ИнвНом.ОсновноеСредство,
		|	ИнвНом.ИнвентарныйНомер КАК ИнвентарныйНомер
		|ИЗ
		|	РегистрСведений.ПервоначальныеСведенияОСБухгалтерскийУчет.СрезПоследних КАК ИнвНом
		|ГДЕ
		|	ИнвНом.Организация = &Организация";
		
		Запрос.УстановитьПараметр("Организация", Организация);
		Запрос.УстановитьПараметр("Период",		 Период);
		
		Результат = Запрос.Выполнить();
		
		ТаблицаОС = Результат.Выгрузить();		
		
		Для Каждого строкаТЧ из ТаблицаОС Цикл
			
			ЦифрыИН = сред(строкаТЧ.ИнвентарныйНомер,3);
			
			ДлинаИнвНом = СтрДлина(ЦифрыИН);
			
			Для Сч = ДлинаИнвНом по 10 Цикл
				ЦифрыИН = "0" + ЦифрыИН;				
			КонецЦикла;			
			
			СтрокаТЧ.ИнвентарныйНомер = ЦифрыИН;
			
		КонецЦикла;
		
		ТаблицаОС.Сортировать("ИнвентарныйНомер Возр");
		
	КонецЕсли;  
	
	СтрокаТЧ = ТаблицаОС.Найти(ОС);
	
	Если СтрокаТЧ = Неопределено тогда
		
		КоличествоСтрок = ТаблицаОС.Количество();
		ПоследняяСтрока = ТаблицаОС[КоличествоСтрок-1];
		ПоследнийИнвНом = число(Сред(ПоследняяСтрока.ИнвентарныйНомер,3));
		Префикс = Сред(ОС.Код,1,2);
		НовыйИнвНом	= Префикс + Формат(ПоследнийИнвНом+1,"ЧЦ=9; ЧВН=; ЧГ=0");
		СтрокаТЧ = ТаблицаОС.Добавить();
		СтрокаТЧ.ОсновноеСредство = ОС;
		СтрокаТЧ.ИнвентарныйНомер = НовыйИнвНом;
		
		возврат НовыйИнвНом;
		
	Иначе
		
		Возврат СтрокаТЧ.ИнвентарныйНомер;
		
	КонецЕсли;
	
	
	
КонецФункции
