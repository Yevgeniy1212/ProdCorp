Перем СоответствиеВалютныеСпособыРасчета;

Перем мВалютаРегламентированногоУчета Экспорт;

////////////////////////////////////////////////////////////////////////////////
// ЭКСПОРТНЫЕ ПРОЦЕДУРЫ И ФУНКЦИИ ДОКУМЕНТА   

////////////////////////////////////////////////////////////////////////////////
// ПРОЦЕДУРЫ И ФУНКЦИИ ДЛЯ ОБЕСПЕЧЕНИЯ РАБОТЫ ФОРМ

// Добавляет строки в таблицы начислений на основе данных регистра сведений "ПлановыеНачисленияРаботниковОрганизаций"
//
// Параметры
//
Процедура ДобавитьСтрокиНачисленийПоРаботнику(Сотрудник) Экспорт
	
	ГоловнаяОрганизация = ОбщегоНазначения.ГоловнаяОрганизация(Организация);
	
	ЗапросНачисления = Новый Запрос;
	ЗапросНачисления.УстановитьПараметр("Сотрудник", 	Сотрудник);
	ЗапросНачисления.УстановитьПараметр("Организация",  ГоловнаяОрганизация);
	ЗапросНачисления.УстановитьПараметр("Период", 		Дата);
	ЗапросНачисления.УстановитьПараметр("Регистратор", 	Ссылка);
	ЗапросНачисления.УстановитьПараметр("Прекратить", 	Перечисления.ВидыДействияСНачислением.Прекратить);
	ЗапросНачисления.УстановитьПараметр("НачальнаяДата", '00010101');
	
	ЗапросНачисления.Текст = 
	"ВЫБРАТЬ РАЗРЕШЕННЫЕ
	|	ВЫБОР
	|		КОГДА Начисления.ВидРасчета ССЫЛКА ПланВидовРасчета.ОсновныеНачисленияОрганизаций
	|			ТОГДА ""Основные""
	|		ИНАЧЕ ""Дополнительные""
	|	КОНЕЦ КАК ВидНачислений,
	|	Начисления.Сотрудник,
	|	Начисления.Сотрудник.ФизЛицо КАК ФизЛицо,
	|	ВЫБОР
	|		КОГДА Начисления.ПериодЗавершения < &Период
	|				И Начисления.ПериодЗавершения <> &НачальнаяДата
	|			ТОГДА Начисления.ВидРасчетаЗавершения
	|		ИНАЧЕ Начисления.ВидРасчета
	|	КОНЕЦ КАК ВидРасчета,
	|	&Период КАК ДатаДействия,
	|	ВЫБОР
	|		КОГДА Начисления.ПериодЗавершения > &Период
	|				И Начисления.ПериодЗавершения <> &НачальнаяДата
	|			ТОГДА Начисления.ПериодЗавершения
	|		ИНАЧЕ &НачальнаяДата
	|	КОНЕЦ КАК ДатаДействияКонец,
	|
	|
	|	ВЫБОР
	|		КОГДА Начисления.ПериодЗавершения < &Период
	|				И Начисления.ПериодЗавершения <> &НачальнаяДата
	|			ТОГДА Начисления.Показатель1Завершения
	|		ИНАЧЕ Начисления.Показатель1
	|	КОНЕЦ КАК Показатель1,
	|	ВЫБОР
	|		КОГДА Начисления.ПериодЗавершения < &Период
	|				И Начисления.ПериодЗавершения <> &НачальнаяДата
	|			ТОГДА Начисления.ТарифныйРазряд1Завершения
	|		ИНАЧЕ Начисления.ТарифныйРазряд1
	|	КОНЕЦ КАК ТарифныйРазряд1,
	|	ВЫБОР
	|		КОГДА Начисления.ПериодЗавершения < &Период
	|				И Начисления.ПериодЗавершения <> &НачальнаяДата
	|			ТОГДА Начисления.Валюта1Завершения
	|		ИНАЧЕ Начисления.Валюта1
	|	КОНЕЦ КАК Валюта1,
	|
	|
	|	ВЫБОР
	|		КОГДА Начисления.ПериодЗавершения < &Период
	|				И Начисления.ПериодЗавершения <> &НачальнаяДата
	|			ТОГДА Начисления.Показатель2Завершения
	|		ИНАЧЕ Начисления.Показатель2
	|	КОНЕЦ КАК Показатель2,
	|	ВЫБОР
	|		КОГДА Начисления.ПериодЗавершения < &Период
	|				И Начисления.ПериодЗавершения <> &НачальнаяДата
	|			ТОГДА Начисления.ТарифныйРазряд2Завершения
	|		ИНАЧЕ Начисления.ТарифныйРазряд2
	|	КОНЕЦ КАК ТарифныйРазряд2,
	|	ВЫБОР
	|		КОГДА Начисления.ПериодЗавершения < &Период
	|				И Начисления.ПериодЗавершения <> &НачальнаяДата
	|			ТОГДА Начисления.Валюта2Завершения
	|		ИНАЧЕ Начисления.Валюта2
	|	КОНЕЦ КАК Валюта2,
	|
	|
	|	ВЫБОР
	|		КОГДА Начисления.ПериодЗавершения < &Период
	|				И Начисления.ПериодЗавершения <> &НачальнаяДата
	|			ТОГДА Начисления.Показатель3Завершения
	|		ИНАЧЕ Начисления.Показатель3
	|	КОНЕЦ КАК Показатель3,
	|	ВЫБОР
	|		КОГДА Начисления.ПериодЗавершения < &Период
	|				И Начисления.ПериодЗавершения <> &НачальнаяДата
	|			ТОГДА Начисления.ТарифныйРазряд3Завершения
	|		ИНАЧЕ Начисления.ТарифныйРазряд3
	|	КОНЕЦ КАК ТарифныйРазряд3,
	|	ВЫБОР
	|		КОГДА Начисления.ПериодЗавершения < &Период
	|				И Начисления.ПериодЗавершения <> &НачальнаяДата
	|			ТОГДА Начисления.Валюта3Завершения
	|		ИНАЧЕ Начисления.Валюта3
	|	КОНЕЦ КАК Валюта3,
	|
	|
	|	ВЫБОР
	|		КОГДА Начисления.ПериодЗавершения < &Период
	|				И Начисления.ПериодЗавершения <> &НачальнаяДата
	|			ТОГДА Начисления.Показатель4Завершения
	|		ИНАЧЕ Начисления.Показатель4
	|	КОНЕЦ КАК Показатель4,
	|	ВЫБОР
	|		КОГДА Начисления.ПериодЗавершения < &Период
	|				И Начисления.ПериодЗавершения <> &НачальнаяДата
	|			ТОГДА Начисления.ТарифныйРазряд4Завершения
	|		ИНАЧЕ Начисления.ТарифныйРазряд4
	|	КОНЕЦ КАК ТарифныйРазряд4,
	|	ВЫБОР
	|		КОГДА Начисления.ПериодЗавершения < &Период
	|				И Начисления.ПериодЗавершения <> &НачальнаяДата
	|			ТОГДА Начисления.Валюта4Завершения
	|		ИНАЧЕ Начисления.Валюта4
	|	КОНЕЦ КАК Валюта4,
	|
	|
	|	ВЫБОР
	|		КОГДА Начисления.ПериодЗавершения < &Период
	|				И Начисления.ПериодЗавершения <> &НачальнаяДата
	|			ТОГДА Начисления.Показатель5Завершения
	|		ИНАЧЕ Начисления.Показатель5
	|	КОНЕЦ КАК Показатель5,
	|	ВЫБОР
	|		КОГДА Начисления.ПериодЗавершения < &Период
	|				И Начисления.ПериодЗавершения <> &НачальнаяДата
	|			ТОГДА Начисления.ТарифныйРазряд5Завершения
	|		ИНАЧЕ Начисления.ТарифныйРазряд5
	|	КОНЕЦ КАК ТарифныйРазряд5,
	|	ВЫБОР
	|		КОГДА Начисления.ПериодЗавершения < &Период
	|				И Начисления.ПериодЗавершения <> &НачальнаяДата
	|			ТОГДА Начисления.Валюта5Завершения
	|		ИНАЧЕ Начисления.Валюта5
	|	КОНЕЦ КАК Валюта5,
	|
	|
	|	ВЫБОР
	|		КОГДА Начисления.ПериодЗавершения < &Период
	|				И Начисления.ПериодЗавершения <> &НачальнаяДата
	|			ТОГДА Начисления.Показатель6Завершения
	|		ИНАЧЕ Начисления.Показатель6
	|	КОНЕЦ КАК Показатель6,
	|	ВЫБОР
	|		КОГДА Начисления.ПериодЗавершения < &Период
	|				И Начисления.ПериодЗавершения <> &НачальнаяДата
	|			ТОГДА Начисления.ТарифныйРазряд6Завершения
	|		ИНАЧЕ Начисления.ТарифныйРазряд6
	|	КОНЕЦ КАК ТарифныйРазряд6,
	|	ВЫБОР
	|		КОГДА Начисления.ПериодЗавершения < &Период
	|				И Начисления.ПериодЗавершения <> &НачальнаяДата
	|			ТОГДА Начисления.Валюта6Завершения
	|		ИНАЧЕ Начисления.Валюта6
	|	КОНЕЦ КАК Валюта6
	|
	|ИЗ
	|	РегистрСведений.ПлановыеНачисленияРаботниковОрганизаций.СрезПоследних(
	|		&Период,
	|		Сотрудник = &Сотрудник
	|		    И Регистратор <> &Регистратор
	|		    И Организация = &Организация) КАК Начисления
	|ГДЕ
	|	Начисления.ВидРасчета.Код ЕСТЬ НЕ NULL 
	|	И ВЫБОР
	|			КОГДА Начисления.ПериодЗавершения < &Период
	|					И Начисления.ПериодЗавершения <> &НачальнаяДата
	|				ТОГДА Начисления.ДействиеЗавершения
	|			ИНАЧЕ Начисления.Действие
	|		КОНЕЦ <> &Прекратить";

	
	Выборка = ЗапросНачисления.Выполнить().Выбрать();
	
	СтруктураПоиска = Новый Структура("Сотрудник, ВидРасчета, Действие");
	СтруктураПоиска.Действие   = Перечисления.ВидыДействияСНачислением.НеИзменять;
	
	Пока Выборка.Следующий() Цикл
		
		СтруктураПоиска.Сотрудник  	= Выборка.Сотрудник;
		СтруктураПоиска.ВидРасчета 	= Выборка.ВидРасчета;
		Если Выборка.ВидНачислений 	= "Основные" Тогда
			МассивНачислений = ОсновныеНачисления.НайтиСтроки(СтруктураПоиска);
		Иначе	
			МассивНачислений = ДополнительныеНачисления.НайтиСтроки(СтруктураПоиска);
		КонецЕсли; 
		
		Если МассивНачислений.Количество() <> 0 Тогда
			Продолжить;
		КонецЕсли; 

		Если Выборка.ВидНачислений = "Основные" Тогда
			НоваяСтрокаТЧ 					= ОсновныеНачисления.Добавить();
		Иначе
			НоваяСтрокаТЧ 					= ДополнительныеНачисления.Добавить();
		КонецЕсли;			
		
		ЗаполнитьЗначенияСвойств(НоваяСтрокаТЧ, Выборка);
		НоваяСтрокаТЧ.Действие   		= Перечисления.ВидыДействияСНачислением.НеИзменять;
		
	КонецЦикла;

КонецПроцедуры

// Удаляет строки начислений по РаботникиОрганизации
Процедура УдалитьСтрокиНачисленийПоРаботнику(Сотрудник) Экспорт
	
	СтруктураПоиска = Новый Структура("Сотрудник", Сотрудник);
	
	МассивСтрок = ОсновныеНачисления.НайтиСтроки(СтруктураПоиска);
	Для Каждого СтрокаТабличнойЧасти Из МассивСтрок Цикл
		ОсновныеНачисления.Удалить(СтрокаТабличнойЧасти); 
	КонецЦикла; 
	
	МассивСтрок = ДополнительныеНачисления.НайтиСтроки(СтруктураПоиска);
	Для Каждого СтрокаТабличнойЧасти Из МассивСтрок Цикл
		ДополнительныеНачисления.Удалить(СтрокаТабличнойЧасти); 
	КонецЦикла; 
	
КонецПроцедуры

////////////////////////////////////////////////////////////////////////////////
// ПРОЦЕДУРЫ И ФУНКЦИИ ДЛЯ ОБЕСПЕЧЕНИЯ ПРОВЕДЕНИЯ ДОКУМЕНТА

// Формирует запрос по шапке документа
//
// Параметры: 
//  Режим - режим проведения
//
// Возвращаемое значение:
//  Результат запроса
//
Функция СформироватьЗапросПоШапке(Режим)

	Запрос = Новый Запрос;

	// Установим параметры запроса
	Запрос.УстановитьПараметр("ДокументСсылка" , Ссылка);
	Запрос.УстановитьПараметр("ПустаяОрганизация" , Справочники.Организации.ПустаяСсылка());


	Запрос.Текст = "
	|Выбрать 
	|	Дата, 
	|	Организация,
	|	ВЫБОР 
	|		КОГДА Организация.ГоловнаяОрганизация = &ПустаяОрганизация 
	|			ТОГДА Организация 
	|		ИНАЧЕ Организация.ГоловнаяОрганизация 
	|	КОНЕЦ КАК ГоловнаяОрганизация,
	| 	Ссылка 
	|Из 
	|	Документ." + Метаданные().Имя + "
	|Где 
	|	Ссылка = &ДокументСсылка
	|";

	Возврат Запрос.Выполнить();

КонецФункции // СформироватьЗапросПоШапке()

// Формирует запрос по таблице "РаботникиОрганизации" документа
//
// Параметры: 
//  Режим - режим проведения
//
// Возвращаемое значение:
//  Результат запроса. В запросе данные документа дополняются значениями
//  проверяемых параметров из связанного с
//
Функция СформироватьЗапросПоРаботникиОрганизации(ВыборкаПоШапкеДокумента)

	Запрос = Новый Запрос;
	Запрос.МенеджерВременныхТаблиц = Новый МенеджерВременныхТаблиц;
	
	// Установим параметры запроса
	Запрос.УстановитьПараметр("ДокументСсылка", Ссылка);
	Запрос.УстановитьПараметр("ГоловнаяОрганизация", ВыборкаПоШапкеДокумента.ГоловнаяОрганизация);
	
	УчетнаяПолитикаПоПерсоналуОрганизации = глЗначениеПеременной("глУчетнаяПолитикаПоПерсоналуОрганизации")[Организация];
	ПроверкаШтатногоРасписания = УчетнаяПолитикаПоПерсоналуОрганизации.ПроверкаШтатногоРасписания;
	
    Если ПроверкаШтатногоРасписания Тогда
		МассивСпособов = Новый Массив;
		МассивСпособов.Добавить(Перечисления.СпособыРасчетаОплатыТруда.ПоМесячнойТарифнойСтавкеПоДням);
		МассивСпособов.Добавить(Перечисления.СпособыРасчетаОплатыТруда.ПоМесячнойТарифнойСтавкеПоЧасам);
		
		МассивСпособовЧасовых = Новый Массив;
		МассивСпособовЧасовых.Добавить(Перечисления.СпособыРасчетаОплатыТруда.ПоЧасовойТарифнойСтавке);
		
		МассивДействий = Новый Массив;
		МассивДействий.Добавить(Перечисления.ВидыДействияСНачислением.Начать);
		МассивДействий.Добавить(Перечисления.ВидыДействияСНачислением.Изменить);
		
		Запрос.УстановитьПараметр("ИзменитьРасчеты", МассивДействий);
		Запрос.УстановитьПараметр("МесячнаяСтавка", Перечисления.ВидыТарифныхСтавок.Месячная);
		Запрос.УстановитьПараметр("МесячныеРасчеты", МассивСпособов);
		Запрос.УстановитьПараметр("ДневнаяСтавка", Перечисления.ВидыТарифныхСтавок.Дневная);
		Запрос.УстановитьПараметр("ДневнойРасчет", Перечисления.СпособыРасчетаОплатыТруда.ПоДневнойТарифнойСтавке);
		Запрос.УстановитьПараметр("ЧасоваяСтавка", Перечисления.ВидыТарифныхСтавок.Часовая);
		Запрос.УстановитьПараметр("ЧасовыеРасчеты", МассивСпособовЧасовых);
		
		ШтатноеРасписаниеОрганизацийТекст =
			"ВЫБРАТЬ
			|	ДатыШтатногоРасписания.НомерСтроки КАК НомерСтроки,
			|	ДатыШтатногоРасписания.ПодразделениеОрганизации КАК ПодразделениеОрганизации,
			|	ДатыШтатногоРасписания.Должность КАК Должность,
			|	ДатыШтатногоРасписания.ТарифныйРазряд КАК ТарифныйРазряд,
			|	ШтатноеРасписаниеОрганизаций.МинимальнаяТарифнаяСтавка КАК МинимальнаяТарифнаяСтавка,
			|	ШтатноеРасписаниеОрганизаций.МаксимальнаяТарифнаяСтавка КАК МаксимальнаяТарифнаяСтавка,
			|	ШтатноеРасписаниеОрганизаций.ВидТарифнойСтавки КАК ВидТарифнойСтавки
			|ПОМЕСТИТЬ ВТ_ШтатноеРасписаниеОрганизаций
			|ИЗ
			|	(ВЫБРАТЬ
			|		ДанныеРаботников.НомерСтроки КАК НомерСтроки,
			|		ДанныеРаботников.Сотрудник КАК Сотрудник,
			|		ДанныеРаботников.ПодразделениеОрганизации КАК ПодразделениеОрганизации,
			|		ДанныеРаботников.Должность КАК Должность,
			|		ДанныеРаботников.ТарифныйРазряд КАК ТарифныйРазряд,
			|		МАКСИМУМ(ШтатноеРасписаниеОрганизаций.Период) КАК Период
			|	ИЗ
			|		(ВЫБРАТЬ
			|			ДатыРаботников.НомерСтроки КАК НомерСтроки,
			|			ДатыРаботников.Сотрудник КАК Сотрудник,
			|			РаботникиОрганизации.ПодразделениеОрганизации КАК ПодразделениеОрганизации,
			|			РаботникиОрганизации.Должность КАК Должность,
			|			РаботникиОрганизации.ТарифныйРазряд КАК ТарифныйРазряд,
			|			ДатыРаботников.ДатаДействия КАК ДатаДействия
			|		ИЗ
			|			(ВЫБРАТЬ
			|				ВводСведенийОПлановыхНачисленияхРаботниковОрганизацииОсновныеНачисления.НомерСтроки КАК НомерСтроки,
			|				ВводСведенийОПлановыхНачисленияхРаботниковОрганизацииОсновныеНачисления.Сотрудник КАК Сотрудник,
			|				МАКСИМУМ(РаботникиОрганизации.Период) КАК Период,
			|				ВводСведенийОПлановыхНачисленияхРаботниковОрганизацииОсновныеНачисления.ДатаДействия КАК ДатаДействия
			|			ИЗ
			|				Документ.ВводСведенийОПлановыхНачисленияхРаботниковОрганизаций.ОсновныеНачисления КАК ВводСведенийОПлановыхНачисленияхРаботниковОрганизацииОсновныеНачисления
			|					ЛЕВОЕ СОЕДИНЕНИЕ РегистрСведений.РаботникиОрганизаций КАК РаботникиОрганизации
			|					ПО ВводСведенийОПлановыхНачисленияхРаботниковОрганизацииОсновныеНачисления.Сотрудник = РаботникиОрганизации.Сотрудник
			|						И (РаботникиОрганизации.Организация = &ГоловнаяОрганизация)
			|						И ВводСведенийОПлановыхНачисленияхРаботниковОрганизацииОсновныеНачисления.ДатаДействия >= РаботникиОрганизации.Период
			|			ГДЕ
			|				ВводСведенийОПлановыхНачисленияхРаботниковОрганизацииОсновныеНачисления.Ссылка = &ДокументСсылка
			|			
			|			СГРУППИРОВАТЬ ПО
			|				ВводСведенийОПлановыхНачисленияхРаботниковОрганизацииОсновныеНачисления.НомерСтроки,
			|				ВводСведенийОПлановыхНачисленияхРаботниковОрганизацииОсновныеНачисления.Сотрудник,
			|				ВводСведенийОПлановыхНачисленияхРаботниковОрганизацииОсновныеНачисления.ДатаДействия) КАК ДатыРаботников
			|				ЛЕВОЕ СОЕДИНЕНИЕ РегистрСведений.РаботникиОрганизаций КАК РаботникиОрганизации
			|				ПО ДатыРаботников.Сотрудник = РаботникиОрганизации.Сотрудник
			|					И (РаботникиОрганизации.Организация = &ГоловнаяОрганизация)
			|					И ДатыРаботников.Период = РаботникиОрганизации.Период) КАК ДанныеРаботников
			|			ЛЕВОЕ СОЕДИНЕНИЕ РегистрСведений.ШтатноеРасписаниеОрганизаций КАК ШтатноеРасписаниеОрганизаций
			|			ПО ДанныеРаботников.ПодразделениеОрганизации = ШтатноеРасписаниеОрганизаций.ПодразделениеОрганизации
			|				И ДанныеРаботников.Должность = ШтатноеРасписаниеОрганизаций.Должность
			|				И ДанныеРаботников.ТарифныйРазряд = ШтатноеРасписаниеОрганизаций.ТарифныйРазряд
			|				И ДанныеРаботников.ДатаДействия >= ШтатноеРасписаниеОрганизаций.Период
			|	
			|	СГРУППИРОВАТЬ ПО
			|		ДанныеРаботников.НомерСтроки,
			|		ДанныеРаботников.Сотрудник,
			|		ДанныеРаботников.ПодразделениеОрганизации,
			|		ДанныеРаботников.Должность,
			|		ДанныеРаботников.ТарифныйРазряд) КАК ДатыШтатногоРасписания
			|		ЛЕВОЕ СОЕДИНЕНИЕ РегистрСведений.ШтатноеРасписаниеОрганизаций КАК ШтатноеРасписаниеОрганизаций
			|		ПО ДатыШтатногоРасписания.ПодразделениеОрганизации = ШтатноеРасписаниеОрганизаций.ПодразделениеОрганизации
			|			И ДатыШтатногоРасписания.Должность = ШтатноеРасписаниеОрганизаций.Должность
			|			И ДатыШтатногоРасписания.ТарифныйРазряд = ШтатноеРасписаниеОрганизаций.ТарифныйРазряд
			|			И ДатыШтатногоРасписания.Период = ШтатноеРасписаниеОрганизаций.Период";
					   
		Запрос.Текст = ШтатноеРасписаниеОрганизацийТекст;
		Запрос.Выполнить();
		ШтатноеРасписаниеОрганизацийТекст = "ВТ_ШтатноеРасписаниеОрганизаций";
	КонецЕсли;

	// Описание текста запроса:
	//
    // 1. Выборка "Начисления": 
	//		Объединяются строки ТЧ Начисления и ДополнительныеНачисления. Сразу проверяем наличие строк-дублей.  
	// 2. Выборка "СуществующиеДвижения": 
	//		Проверяем на наличие существующих конфликтных движений в регистре сведений. 
	
	ТекстЗапроса = "ВЫБРАТЬ
	               |	ТЧОсновныеНачисления.НомерСтроки КАК НомерСтроки,
	               |	ТЧОсновныеНачисления.ВидРасчета,
	               |	МАКСИМУМ(Показатели.НомерСтроки) КАК КоличествоПоказателей,
	               |	Показатели1.Показатель.Наименование КАК Показатель1Наименование,
	               |	Показатели2.Показатель.Наименование КАК Показатель2Наименование,
	               |	Показатели3.Показатель.Наименование КАК Показатель3Наименование,
	               |	Показатели4.Показатель.Наименование КАК Показатель4Наименование,
	               |	Показатели5.Показатель.Наименование КАК Показатель5Наименование,
	               |	Показатели6.Показатель.Наименование КАК Показатель6Наименование,
	               |	Показатели1.Показатель.ТипПоказателя КАК Показатель1ТипПоказателя,
	               |	Показатели2.Показатель.ТипПоказателя КАК Показатель2ТипПоказателя,
	               |	Показатели3.Показатель.ТипПоказателя КАК Показатель3ТипПоказателя,
	               |	Показатели4.Показатель.ТипПоказателя КАК Показатель4ТипПоказателя,
	               |	Показатели5.Показатель.ТипПоказателя КАК Показатель5ТипПоказателя,
	               |	Показатели6.Показатель.ТипПоказателя КАК Показатель6ТипПоказателя,
	               |	Показатели1.Показатель.ВозможностьИзменения КАК Показатель1ВозможностьИзменения,
	               |	Показатели2.Показатель.ВозможностьИзменения КАК Показатель2ВозможностьИзменения,
	               |	Показатели3.Показатель.ВозможностьИзменения КАК Показатель3ВозможностьИзменения,
	               |	Показатели4.Показатель.ВозможностьИзменения КАК Показатель4ВозможностьИзменения,
	               |	Показатели5.Показатель.ВозможностьИзменения КАК Показатель5ВозможностьИзменения,
	               |	Показатели6.Показатель.ВозможностьИзменения КАК Показатель6ВозможностьИзменения,
	               |	Показатели1.Показатель.Валюта КАК Показатель1Валюта,
	               |	Показатели2.Показатель.Валюта КАК Показатель2Валюта,
	               |	Показатели3.Показатель.Валюта КАК Показатель3Валюта,
	               |	Показатели4.Показатель.Валюта КАК Показатель4Валюта,
	               |	Показатели5.Показатель.Валюта КАК Показатель5Валюта,
	               |	Показатели6.Показатель.Валюта КАК Показатель6Валюта,
	               |	Показатели1.Показатель.ТарифнаяСтавка КАК Показатель1ТарифнаяСтавка,
	               |	Показатели2.Показатель.ТарифнаяСтавка КАК Показатель2ТарифнаяСтавка,
	               |	Показатели3.Показатель.ТарифнаяСтавка КАК Показатель3ТарифнаяСтавка,
	               |	Показатели4.Показатель.ТарифнаяСтавка КАК Показатель4ТарифнаяСтавка,
	               |	Показатели5.Показатель.ТарифнаяСтавка КАК Показатель5ТарифнаяСтавка,
	               |	Показатели6.Показатель.ТарифнаяСтавка КАК Показатель6ТарифнаяСтавка,
	               |	Показатели1.ЗапрашиватьПриКадровыхПеремещениях КАК Показатель1ЗапрашиватьПриКадровыхПеремещениях,
	               |	Показатели2.ЗапрашиватьПриКадровыхПеремещениях КАК Показатель2ЗапрашиватьПриКадровыхПеремещениях,
	               |	Показатели3.ЗапрашиватьПриКадровыхПеремещениях КАК Показатель3ЗапрашиватьПриКадровыхПеремещениях,
	               |	Показатели4.ЗапрашиватьПриКадровыхПеремещениях КАК Показатель4ЗапрашиватьПриКадровыхПеремещениях,
	               |	Показатели5.ЗапрашиватьПриКадровыхПеремещениях КАК Показатель5ЗапрашиватьПриКадровыхПеремещениях,
	               |	Показатели6.ЗапрашиватьПриКадровыхПеремещениях КАК Показатель6ЗапрашиватьПриКадровыхПеремещениях,
	               |	Показатели1.Показатель.Предопределенный КАК Показатель1Предопределенный,
	               |	Показатели2.Показатель.Предопределенный КАК Показатель2Предопределенный,
	               |	Показатели3.Показатель.Предопределенный КАК Показатель3Предопределенный,
	               |	Показатели4.Показатель.Предопределенный КАК Показатель4Предопределенный,
	               |	Показатели5.Показатель.Предопределенный КАК Показатель5Предопределенный,
	               |	Показатели6.Показатель.Предопределенный КАК Показатель6Предопределенный
	               |ПОМЕСТИТЬ ВТ_ПоказателиОсновныеНачисления
	               |ИЗ
	               |	Документ.ВводСведенийОПлановыхНачисленияхРаботниковОрганизаций.ОсновныеНачисления КАК ТЧОсновныеНачисления
	               |		ЛЕВОЕ СОЕДИНЕНИЕ ПланВидовРасчета.ОсновныеНачисленияОрганизаций.Показатели КАК Показатели
	               |		ПО ТЧОсновныеНачисления.ВидРасчета = Показатели.Ссылка
	               |		ЛЕВОЕ СОЕДИНЕНИЕ ПланВидовРасчета.ОсновныеНачисленияОрганизаций.Показатели КАК Показатели1
	               |		ПО ТЧОсновныеНачисления.ВидРасчета = Показатели1.Ссылка
	               |			И (Показатели1.НомерСтроки = 1)
	               |		ЛЕВОЕ СОЕДИНЕНИЕ ПланВидовРасчета.ОсновныеНачисленияОрганизаций.Показатели КАК Показатели2
	               |		ПО ТЧОсновныеНачисления.ВидРасчета = Показатели2.Ссылка
	               |			И (Показатели2.НомерСтроки = 2)
	               |		ЛЕВОЕ СОЕДИНЕНИЕ ПланВидовРасчета.ОсновныеНачисленияОрганизаций.Показатели КАК Показатели3
	               |		ПО ТЧОсновныеНачисления.ВидРасчета = Показатели3.Ссылка
	               |			И (Показатели3.НомерСтроки = 3)
	               |		ЛЕВОЕ СОЕДИНЕНИЕ ПланВидовРасчета.ОсновныеНачисленияОрганизаций.Показатели КАК Показатели4
	               |		ПО ТЧОсновныеНачисления.ВидРасчета = Показатели4.Ссылка
	               |			И (Показатели4.НомерСтроки = 4)
	               |		ЛЕВОЕ СОЕДИНЕНИЕ ПланВидовРасчета.ОсновныеНачисленияОрганизаций.Показатели КАК Показатели5
	               |		ПО ТЧОсновныеНачисления.ВидРасчета = Показатели5.Ссылка
	               |			И (Показатели5.НомерСтроки = 5)
	               |		ЛЕВОЕ СОЕДИНЕНИЕ ПланВидовРасчета.ОсновныеНачисленияОрганизаций.Показатели КАК Показатели6
	               |		ПО ТЧОсновныеНачисления.ВидРасчета = Показатели6.Ссылка
	               |			И (Показатели6.НомерСтроки = 6)
	               |ГДЕ
	               |	ТЧОсновныеНачисления.Ссылка = &ДокументСсылка
	               |
	               |СГРУППИРОВАТЬ ПО
	               |	Показатели1.Показатель.Наименование,
	               |	Показатели2.Показатель.Наименование,
	               |	Показатели3.Показатель.Наименование,
	               |	Показатели4.Показатель.Наименование,
	               |	Показатели5.Показатель.Наименование,
	               |	Показатели6.Показатель.Наименование,
	               |	Показатели1.Показатель.ТипПоказателя,
	               |	Показатели2.Показатель.ТипПоказателя,
	               |	Показатели3.Показатель.ТипПоказателя,
	               |	Показатели4.Показатель.ТипПоказателя,
	               |	Показатели5.Показатель.ТипПоказателя,
	               |	Показатели6.Показатель.ТипПоказателя,
	               |	Показатели1.Показатель.ВозможностьИзменения,
	               |	Показатели2.Показатель.ВозможностьИзменения,
	               |	Показатели3.Показатель.ВозможностьИзменения,
	               |	Показатели4.Показатель.ВозможностьИзменения,
	               |	Показатели5.Показатель.ВозможностьИзменения,
	               |	Показатели6.Показатель.ВозможностьИзменения,
	               |	Показатели1.Показатель.Валюта,
	               |	Показатели2.Показатель.Валюта,
	               |	Показатели3.Показатель.Валюта,
	               |	Показатели4.Показатель.Валюта,
	               |	Показатели5.Показатель.Валюта,
	               |	Показатели6.Показатель.Валюта,
	               |	Показатели1.Показатель.ТарифнаяСтавка,
	               |	Показатели2.Показатель.ТарифнаяСтавка,
	               |	Показатели3.Показатель.ТарифнаяСтавка,
	               |	Показатели4.Показатель.ТарифнаяСтавка,
	               |	Показатели5.Показатель.ТарифнаяСтавка,
	               |	Показатели6.Показатель.ТарифнаяСтавка,
	               |	ТЧОсновныеНачисления.НомерСтроки,
	               |	ТЧОсновныеНачисления.ВидРасчета,
	               |	Показатели1.ЗапрашиватьПриКадровыхПеремещениях,
	               |	Показатели2.ЗапрашиватьПриКадровыхПеремещениях,
	               |	Показатели3.ЗапрашиватьПриКадровыхПеремещениях,
	               |	Показатели4.ЗапрашиватьПриКадровыхПеремещениях,
	               |	Показатели5.ЗапрашиватьПриКадровыхПеремещениях,
	               |	Показатели6.ЗапрашиватьПриКадровыхПеремещениях,
	               |	Показатели1.Показатель.Предопределенный,
	               |	Показатели2.Показатель.Предопределенный,
	               |	Показатели3.Показатель.Предопределенный,
	               |	Показатели4.Показатель.Предопределенный,
	               |	Показатели5.Показатель.Предопределенный,
	               |	Показатели6.Показатель.Предопределенный
	               |
	               |ИНДЕКСИРОВАТЬ ПО
	               |	НомерСтроки
	               |;
	               |
	               |////////////////////////////////////////////////////////////////////////////////
	               |ВЫБРАТЬ
	               |	ТЧДополнительныеНачисления.НомерСтроки КАК НомерСтроки,
	               |	ТЧДополнительныеНачисления.ВидРасчета,
	               |	МАКСИМУМ(Показатели.НомерСтроки) КАК КоличествоПоказателей,
	               |	Показатели1.Показатель.Наименование КАК Показатель1Наименование,
	               |	Показатели2.Показатель.Наименование КАК Показатель2Наименование,
	               |	Показатели3.Показатель.Наименование КАК Показатель3Наименование,
	               |	Показатели4.Показатель.Наименование КАК Показатель4Наименование,
	               |	Показатели5.Показатель.Наименование КАК Показатель5Наименование,
	               |	Показатели6.Показатель.Наименование КАК Показатель6Наименование,
	               |	Показатели1.Показатель.ТипПоказателя КАК Показатель1ТипПоказателя,
	               |	Показатели2.Показатель.ТипПоказателя КАК Показатель2ТипПоказателя,
	               |	Показатели3.Показатель.ТипПоказателя КАК Показатель3ТипПоказателя,
	               |	Показатели4.Показатель.ТипПоказателя КАК Показатель4ТипПоказателя,
	               |	Показатели5.Показатель.ТипПоказателя КАК Показатель5ТипПоказателя,
	               |	Показатели6.Показатель.ТипПоказателя КАК Показатель6ТипПоказателя,
	               |	Показатели1.Показатель.ВозможностьИзменения КАК Показатель1ВозможностьИзменения,
	               |	Показатели2.Показатель.ВозможностьИзменения КАК Показатель2ВозможностьИзменения,
	               |	Показатели3.Показатель.ВозможностьИзменения КАК Показатель3ВозможностьИзменения,
	               |	Показатели4.Показатель.ВозможностьИзменения КАК Показатель4ВозможностьИзменения,
	               |	Показатели5.Показатель.ВозможностьИзменения КАК Показатель5ВозможностьИзменения,
	               |	Показатели6.Показатель.ВозможностьИзменения КАК Показатель6ВозможностьИзменения,
	               |	Показатели1.Показатель.Валюта КАК Показатель1Валюта,
	               |	Показатели2.Показатель.Валюта КАК Показатель2Валюта,
	               |	Показатели3.Показатель.Валюта КАК Показатель3Валюта,
	               |	Показатели4.Показатель.Валюта КАК Показатель4Валюта,
	               |	Показатели5.Показатель.Валюта КАК Показатель5Валюта,
	               |	Показатели6.Показатель.Валюта КАК Показатель6Валюта,
	               |	Показатели1.Показатель.ТарифнаяСтавка КАК Показатель1ТарифнаяСтавка,
	               |	Показатели2.Показатель.ТарифнаяСтавка КАК Показатель2ТарифнаяСтавка,
	               |	Показатели3.Показатель.ТарифнаяСтавка КАК Показатель3ТарифнаяСтавка,
	               |	Показатели4.Показатель.ТарифнаяСтавка КАК Показатель4ТарифнаяСтавка,
	               |	Показатели5.Показатель.ТарифнаяСтавка КАК Показатель5ТарифнаяСтавка,
	               |	Показатели6.Показатель.ТарифнаяСтавка КАК Показатель6ТарифнаяСтавка,
	               |	Показатели1.ЗапрашиватьПриКадровыхПеремещениях КАК Показатель1ЗапрашиватьПриКадровыхПеремещениях,
	               |	Показатели2.ЗапрашиватьПриКадровыхПеремещениях КАК Показатель2ЗапрашиватьПриКадровыхПеремещениях,
	               |	Показатели3.ЗапрашиватьПриКадровыхПеремещениях КАК Показатель3ЗапрашиватьПриКадровыхПеремещениях,
	               |	Показатели4.ЗапрашиватьПриКадровыхПеремещениях КАК Показатель4ЗапрашиватьПриКадровыхПеремещениях,
	               |	Показатели5.ЗапрашиватьПриКадровыхПеремещениях КАК Показатель5ЗапрашиватьПриКадровыхПеремещениях,
	               |	Показатели6.ЗапрашиватьПриКадровыхПеремещениях КАК Показатель6ЗапрашиватьПриКадровыхПеремещениях,
	               |	Показатели1.Показатель.Предопределенный КАК Показатель1Предопределенный,
	               |	Показатели2.Показатель.Предопределенный КАК Показатель2Предопределенный,
	               |	Показатели3.Показатель.Предопределенный КАК Показатель3Предопределенный,
	               |	Показатели4.Показатель.Предопределенный КАК Показатель4Предопределенный,
	               |	Показатели5.Показатель.Предопределенный КАК Показатель5Предопределенный,
	               |	Показатели6.Показатель.Предопределенный КАК Показатель6Предопределенный
	               |ПОМЕСТИТЬ ВТ_ПоказателиДополнительныеНачисления
	               |ИЗ
	               |	Документ.ВводСведенийОПлановыхНачисленияхРаботниковОрганизаций.ДополнительныеНачисления КАК ТЧДополнительныеНачисления
	               |		ЛЕВОЕ СОЕДИНЕНИЕ ПланВидовРасчета.ДополнительныеНачисленияОрганизаций.Показатели КАК Показатели
	               |		ПО ТЧДополнительныеНачисления.ВидРасчета = Показатели.Ссылка
	               |		ЛЕВОЕ СОЕДИНЕНИЕ ПланВидовРасчета.ДополнительныеНачисленияОрганизаций.Показатели КАК Показатели1
	               |		ПО ТЧДополнительныеНачисления.ВидРасчета = Показатели1.Ссылка
	               |			И (Показатели1.НомерСтроки = 1)
	               |		ЛЕВОЕ СОЕДИНЕНИЕ ПланВидовРасчета.ДополнительныеНачисленияОрганизаций.Показатели КАК Показатели2
	               |		ПО ТЧДополнительныеНачисления.ВидРасчета = Показатели2.Ссылка
	               |			И (Показатели2.НомерСтроки = 2)
	               |		ЛЕВОЕ СОЕДИНЕНИЕ ПланВидовРасчета.ДополнительныеНачисленияОрганизаций.Показатели КАК Показатели3
	               |		ПО ТЧДополнительныеНачисления.ВидРасчета = Показатели3.Ссылка
	               |			И (Показатели3.НомерСтроки = 3)
	               |		ЛЕВОЕ СОЕДИНЕНИЕ ПланВидовРасчета.ДополнительныеНачисленияОрганизаций.Показатели КАК Показатели4
	               |		ПО ТЧДополнительныеНачисления.ВидРасчета = Показатели4.Ссылка
	               |			И (Показатели4.НомерСтроки = 4)
	               |		ЛЕВОЕ СОЕДИНЕНИЕ ПланВидовРасчета.ДополнительныеНачисленияОрганизаций.Показатели КАК Показатели5
	               |		ПО ТЧДополнительныеНачисления.ВидРасчета = Показатели5.Ссылка
	               |			И (Показатели5.НомерСтроки = 5)
	               |		ЛЕВОЕ СОЕДИНЕНИЕ ПланВидовРасчета.ДополнительныеНачисленияОрганизаций.Показатели КАК Показатели6
	               |		ПО ТЧДополнительныеНачисления.ВидРасчета = Показатели6.Ссылка
	               |			И (Показатели6.НомерСтроки = 6)
	               |ГДЕ
	               |	ТЧДополнительныеНачисления.Ссылка = &ДокументСсылка
	               |
	               |СГРУППИРОВАТЬ ПО
	               |	Показатели1.Показатель.Наименование,
	               |	Показатели2.Показатель.Наименование,
	               |	Показатели3.Показатель.Наименование,
	               |	Показатели4.Показатель.Наименование,
	               |	Показатели5.Показатель.Наименование,
	               |	Показатели6.Показатель.Наименование,
	               |	Показатели1.Показатель.ТипПоказателя,
	               |	Показатели2.Показатель.ТипПоказателя,
	               |	Показатели3.Показатель.ТипПоказателя,
	               |	Показатели4.Показатель.ТипПоказателя,
	               |	Показатели5.Показатель.ТипПоказателя,
	               |	Показатели6.Показатель.ТипПоказателя,
	               |	Показатели1.Показатель.ВозможностьИзменения,
	               |	Показатели2.Показатель.ВозможностьИзменения,
	               |	Показатели3.Показатель.ВозможностьИзменения,
	               |	Показатели4.Показатель.ВозможностьИзменения,
	               |	Показатели5.Показатель.ВозможностьИзменения,
	               |	Показатели6.Показатель.ВозможностьИзменения,
	               |	Показатели1.Показатель.Валюта,
	               |	Показатели2.Показатель.Валюта,
	               |	Показатели3.Показатель.Валюта,
	               |	Показатели4.Показатель.Валюта,
	               |	Показатели5.Показатель.Валюта,
	               |	Показатели6.Показатель.Валюта,
	               |	Показатели1.Показатель.ТарифнаяСтавка,
	               |	Показатели2.Показатель.ТарифнаяСтавка,
	               |	Показатели3.Показатель.ТарифнаяСтавка,
	               |	Показатели4.Показатель.ТарифнаяСтавка,
	               |	Показатели5.Показатель.ТарифнаяСтавка,
	               |	Показатели6.Показатель.ТарифнаяСтавка,
	               |	ТЧДополнительныеНачисления.НомерСтроки,
	               |	ТЧДополнительныеНачисления.ВидРасчета,
	               |	Показатели1.ЗапрашиватьПриКадровыхПеремещениях,
	               |	Показатели2.ЗапрашиватьПриКадровыхПеремещениях,
	               |	Показатели3.ЗапрашиватьПриКадровыхПеремещениях,
	               |	Показатели4.ЗапрашиватьПриКадровыхПеремещениях,
	               |	Показатели5.ЗапрашиватьПриКадровыхПеремещениях,
	               |	Показатели6.ЗапрашиватьПриКадровыхПеремещениях,
	               |	Показатели1.Показатель.Предопределенный,
	               |	Показатели2.Показатель.Предопределенный,
	               |	Показатели3.Показатель.Предопределенный,
	               |	Показатели4.Показатель.Предопределенный,
	               |	Показатели5.Показатель.Предопределенный,
	               |	Показатели6.Показатель.Предопределенный
	               |
	               |ИНДЕКСИРОВАТЬ ПО
	               |	НомерСтроки
				   |;
				   |////////////////////////////////////////////////////////////////////////////////
				   |";
	
	ТекстЗапроса = ТекстЗапроса + 
					"ВЫБРАТЬ РАЗРЕШЕННЫЕ
	               |	Начисления.ВидСтроки,
	               |	Начисления.НомерСтроки,
	               |	Начисления.Сотрудник,
	               |	Начисления.Сотрудник.Наименование,
	               |	Начисления.ВидРасчета,
	               |	ЕСТЬNULL(Начисления.ВидРасчета.ТребуетВводаТарифногоРазряда, ЛОЖЬ) КАК ТребуетВводаТарифногоРазряда,
				   |	Начисления.Показатель1Наименование КАК Показатель1Наименование,
				   |	Начисления.Показатель2Наименование КАК Показатель2Наименование,
				   |	Начисления.Показатель3Наименование КАК Показатель3Наименование,
				   |	Начисления.Показатель4Наименование КАК Показатель4Наименование,
				   |	Начисления.Показатель5Наименование КАК Показатель5Наименование,
				   |	Начисления.Показатель6Наименование КАК Показатель6Наименование,
				   |	Начисления.Показатель6Наименование КАК Показатель1ТипПоказателя,
				   |	Начисления.Показатель2ТипПоказателя КАК Показатель2ТипПоказателя,
				   |	Начисления.Показатель3ТипПоказателя КАК Показатель3ТипПоказателя,
				   |	Начисления.Показатель4ТипПоказателя КАК Показатель4ТипПоказателя,
				   |	Начисления.Показатель5ТипПоказателя КАК Показатель5ТипПоказателя,
				   |	Начисления.Показатель6ТипПоказателя КАК Показатель6ТипПоказателя,
				   |	Начисления.Показатель1ВозможностьИзменения КАК Показатель1ВозможностьИзменения,
				   |	Начисления.Показатель2ВозможностьИзменения КАК Показатель2ВозможностьИзменения,
				   |	Начисления.Показатель3ВозможностьИзменения КАК Показатель3ВозможностьИзменения,
				   |	Начисления.Показатель4ВозможностьИзменения КАК Показатель4ВозможностьИзменения,	
				   |	Начисления.Показатель5ВозможностьИзменения КАК Показатель5ВозможностьИзменения,	
				   |	Начисления.Показатель6ВозможностьИзменения КАК Показатель6ВозможностьИзменения,	
				   |	Начисления.Показатель1ЗапрашиватьПриКадровыхПеремещениях КАК Показатель1ЗапрашиватьПриКадровыхПеремещениях, 
				   |	Начисления.Показатель2ЗапрашиватьПриКадровыхПеремещениях КАК Показатель2ЗапрашиватьПриКадровыхПеремещениях, 
				   |	Начисления.Показатель3ЗапрашиватьПриКадровыхПеремещениях КАК Показатель3ЗапрашиватьПриКадровыхПеремещениях, 
				   |	Начисления.Показатель4ЗапрашиватьПриКадровыхПеремещениях КАК Показатель4ЗапрашиватьПриКадровыхПеремещениях, 
				   |	Начисления.Показатель5ЗапрашиватьПриКадровыхПеремещениях КАК Показатель5ЗапрашиватьПриКадровыхПеремещениях, 
				   |	Начисления.Показатель6ЗапрашиватьПриКадровыхПеремещениях КАК Показатель6ЗапрашиватьПриКадровыхПеремещениях, 
				   |	Начисления.Показатель1Предопределенный КАК Показатель1Предопределенный,
				   |	Начисления.Показатель2Предопределенный КАК Показатель2Предопределенный,
				   |	Начисления.Показатель3Предопределенный КАК Показатель3Предопределенный,
				   |	Начисления.Показатель4Предопределенный КАК Показатель4Предопределенный,
				   |	Начисления.Показатель5Предопределенный КАК Показатель5Предопределенный,
				   |	Начисления.Показатель6Предопределенный КАК Показатель6Предопределенный,
	               |	Начисления.СпособРасчета,
	               |	Начисления.ПроизвольнаяФормулаРасчета,
	               |	Начисления.КоличествоПоказателей,
				   |	Начисления.ОсновноеНачисление,
	               |	Начисления.Действие,
				   |	Начисления.ДатаДействия,
				   |	Начисления.ДатаДействияКонец,
				   |	Начисления.ТарифныйРазряд1,
				   |	Начисления.ТарифныйРазряд2,
				   |	Начисления.ТарифныйРазряд3,
				   |	Начисления.ТарифныйРазряд4,
				   |	Начисления.ТарифныйРазряд5,
				   |	Начисления.ТарифныйРазряд6,
				   |	Начисления.Показатель1,
				   |	Начисления.Показатель2,
				   |	Начисления.Показатель3,
				   |	Начисления.Показатель4,
				   |	Начисления.Показатель5,
				   |	Начисления.Показатель6,
				   |	ВЫБОР
				   |		КОГДА Начисления.Сотрудник.Организация = &ГоловнаяОрганизация
				   |			ТОГДА ЛОЖЬ
				   |		ИНАЧЕ ИСТИНА
				   |	КОНЕЦ КАК ОшибкаНеСоответствиеСотрудникаИОрганизации";
	Если Не УчетнаяПолитикаПоПерсоналуОрганизации.ИспользуютсяНачисленияВВалюте Тогда
	   ТекстЗапроса = ТекстЗапроса + ",
				   |	&ВалютаРегУчета КАК Валюта1,
				   |	&ВалютаРегУчета КАК Валюта2,
				   |	&ВалютаРегУчета КАК Валюта3,
				   |	&ВалютаРегУчета КАК Валюта4,
				   |	&ВалютаРегУчета КАК Валюта5,
				   |	&ВалютаРегУчета КАК Валюта6";
	Иначе
		ТекстЗапроса = ТекстЗапроса + ",
				   |	Начисления.Валюта1,
				   |	Начисления.Валюта2,
				   |	Начисления.Валюта3,
				   |	Начисления.Валюта4,
				   |	Начисления.Валюта5,
				   |	Начисления.Валюта6";
	КонецЕсли;
	ТекстЗапроса = ТекстЗапроса + ",
	               |	Начисления.КонфликтнаяСтрокаНомер,
	               |	СуществующиеДвижения.Регистратор.Представление КАК КонфликтныйДокумент";
    Если ПроверкаШтатногоРасписания Тогда
		ТекстЗапроса = ТекстЗапроса + ",
	               |	Начисления.РазмерСоответствуетШТР";
	КонецЕсли;
			   
	ТекстЗапроса = ТекстЗапроса + "
	               |ИЗ
	               |	(ВЫБРАТЬ
	               |		ТЧОсновныеНачисления.НомерСтроки КАК НомерСтроки,
	               |		""Основные начисления"" КАК ВидСтроки,
	               |		ТЧОсновныеНачисления.Сотрудник КАК Сотрудник,
	               |		ТЧОсновныеНачисления.ВидРасчета КАК ВидРасчета,
	               |		ВЫБОР 
	               |			КОГДА ТЧОсновныеНачисления.ВидРасчета.ЗачетОтработанногоВремени 
	               |				ТОГДА НЕОПРЕДЕЛЕНО 
	               |			ИНАЧЕ ТЧОсновныеНачисления.ВидРасчета 
	               |		КОНЕЦ КАК ВидРасчетаИзмерение,
	               |		ТЧОсновныеНачисления.ВидРасчета.СпособРасчета КАК СпособРасчета,
	               |		ВЫБОР
				   |			КОГДА ТЧОсновныеНачисления.ВидРасчета.СпособРасчета = ЗНАЧЕНИЕ(Перечисление.СпособыРасчетаОплатыТруда.ПроизвольнаяФормула)
				   |				ТОГДА ИСТИНА
				   |			ИНАЧЕ ЛОЖЬ
				   |		КОНЕЦ КАК ПроизвольнаяФормулаРасчета,
				   |		ЕСТЬNULL(Показатели.КоличествоПоказателей, 0) КАК КоличествоПоказателей,
				   |		ТЧОсновныеНачисления.ВидРасчета.ЗачетОтработанногоВремени КАК ОсновноеНачисление,
	               |		ТЧОсновныеНачисления.Действие КАК Действие,
	               |		ТЧОсновныеНачисления.ДатаДействия КАК ДатаДействия,
	               |		ТЧОсновныеНачисления.ДатаДействияКонец КАК ДатаДействияКонец,
	               |		Показатели.Показатель1Наименование КАК Показатель1Наименование,
				   |		Показатели.Показатель2Наименование КАК Показатель2Наименование,
				   |		Показатели.Показатель3Наименование КАК Показатель3Наименование,
				   |		Показатели.Показатель4Наименование КАК Показатель4Наименование,
				   |		Показатели.Показатель5Наименование КАК Показатель5Наименование,
				   |		Показатели.Показатель6Наименование КАК Показатель6Наименование,
				   |		Показатели.Показатель1ТипПоказателя КАК Показатель1ТипПоказателя,
				   |		Показатели.Показатель2ТипПоказателя КАК Показатель2ТипПоказателя,
				   |		Показатели.Показатель3ТипПоказателя КАК Показатель3ТипПоказателя,
				   |		Показатели.Показатель4ТипПоказателя КАК Показатель4ТипПоказателя,
				   |		Показатели.Показатель5ТипПоказателя КАК Показатель5ТипПоказателя,
				   |		Показатели.Показатель6ТипПоказателя КАК Показатель6ТипПоказателя,
				   |		Показатели.Показатель1ВозможностьИзменения КАК Показатель1ВозможностьИзменения,
				   |		Показатели.Показатель2ВозможностьИзменения КАК Показатель2ВозможностьИзменения,
				   |		Показатели.Показатель3ВозможностьИзменения КАК Показатель3ВозможностьИзменения,
				   |		Показатели.Показатель4ВозможностьИзменения КАК Показатель4ВозможностьИзменения,	
				   |		Показатели.Показатель5ВозможностьИзменения КАК Показатель5ВозможностьИзменения,	
				   |		Показатели.Показатель6ВозможностьИзменения КАК Показатель6ВозможностьИзменения,	
				   |		Показатели.Показатель1ЗапрашиватьПриКадровыхПеремещениях КАК Показатель1ЗапрашиватьПриКадровыхПеремещениях,
				   |		Показатели.Показатель2ЗапрашиватьПриКадровыхПеремещениях КАК Показатель2ЗапрашиватьПриКадровыхПеремещениях,
				   |		Показатели.Показатель3ЗапрашиватьПриКадровыхПеремещениях КАК Показатель3ЗапрашиватьПриКадровыхПеремещениях,
				   |		Показатели.Показатель4ЗапрашиватьПриКадровыхПеремещениях КАК Показатель4ЗапрашиватьПриКадровыхПеремещениях,
				   |		Показатели.Показатель5ЗапрашиватьПриКадровыхПеремещениях КАК Показатель5ЗапрашиватьПриКадровыхПеремещениях,
				   |		Показатели.Показатель6ЗапрашиватьПриКадровыхПеремещениях КАК Показатель6ЗапрашиватьПриКадровыхПеремещениях,
				   |		Показатели.Показатель1Предопределенный КАК Показатель1Предопределенный,
				   |		Показатели.Показатель2Предопределенный КАК Показатель2Предопределенный,
				   |		Показатели.Показатель3Предопределенный КАК Показатель3Предопределенный,
				   |		Показатели.Показатель4Предопределенный КАК Показатель4Предопределенный,
				   |		Показатели.Показатель5Предопределенный КАК Показатель5Предопределенный,
				   |		Показатели.Показатель6Предопределенный КАК Показатель6Предопределенный,
 				   |		ТЧОсновныеНачисления.Показатель1 КАК Показатель1,
	               |		ТЧОсновныеНачисления.Показатель2 КАК Показатель2,
	               |		ТЧОсновныеНачисления.Показатель3 КАК Показатель3,
	               |		ТЧОсновныеНачисления.Показатель4 КАК Показатель4,
	               |		ТЧОсновныеНачисления.Показатель5 КАК Показатель5,
	               |		ТЧОсновныеНачисления.Показатель6 КАК Показатель6,
				   |		ТЧОсновныеНачисления.ТарифныйРазряд1 КАК ТарифныйРазряд1,
				   |		ТЧОсновныеНачисления.ТарифныйРазряд2 КАК ТарифныйРазряд2,
				   |		ТЧОсновныеНачисления.ТарифныйРазряд3 КАК ТарифныйРазряд3,
				   |		ТЧОсновныеНачисления.ТарифныйРазряд4 КАК ТарифныйРазряд4,
				   |		ТЧОсновныеНачисления.ТарифныйРазряд5 КАК ТарифныйРазряд5,
				   |		ТЧОсновныеНачисления.ТарифныйРазряд6 КАК ТарифныйРазряд6,
	               |		ТЧОсновныеНачисления.Валюта1 КАК Валюта1,
	               |		ТЧОсновныеНачисления.Валюта2 КАК Валюта2,
	               |		ТЧОсновныеНачисления.Валюта3 КАК Валюта3,
	               |		ТЧОсновныеНачисления.Валюта4 КАК Валюта4,
	               |		ТЧОсновныеНачисления.Валюта5 КАК Валюта5,
	               |		ТЧОсновныеНачисления.Валюта6 КАК Валюта6,
	               |		МИНИМУМ(ПовторяющиесяСтроки.НомерСтроки) КАК КонфликтнаяСтрокаНомер";
    Если ПроверкаШтатногоРасписания Тогда
		ТекстЗапроса = ТекстЗапроса + ",
	               |		ВЫБОР 
	               |			КОГДА ТЧОсновныеНачисления.ВидРасчета.ЗачетОтработанногоВремени 
	               |					И ТЧОсновныеНачисления.Действие В (&ИзменитьРасчеты) 
	               |				ТОГДА ВЫБОР 
	               |						КОГДА ТЧОсновныеНачисления.ВидРасчета.СпособРасчета В (&МесячныеРасчеты) 
	               |								И ШтатноеРасписаниеОрганизаций.ВидТарифнойСтавки = &МесячнаяСтавка 
	               |							ТОГДА ВЫБОР 
	               |									КОГДА ТЧОсновныеНачисления.Показатель1 < ШтатноеРасписаниеОрганизаций.МинимальнаяТарифнаяСтавка 
	               |											ИЛИ ТЧОсновныеНачисления.Показатель1 > ШтатноеРасписаниеОрганизаций.МаксимальнаяТарифнаяСтавка 
	               |										ТОГДА ЛОЖЬ 
	               |									ИНАЧЕ ИСТИНА 
	               |								  КОНЕЦ 
	               |
	               |						КОГДА ТЧОсновныеНачисления.ВидРасчета.СпособРасчета = &ДневнойРасчет 
	               |								И ШтатноеРасписаниеОрганизаций.ВидТарифнойСтавки = &ДневнаяСтавка 
	               |							ТОГДА ВЫБОР 
	               |									КОГДА ТЧОсновныеНачисления.Показатель1 < ШтатноеРасписаниеОрганизаций.МинимальнаяТарифнаяСтавка 
	               |											ИЛИ ТЧОсновныеНачисления.Показатель1 > ШтатноеРасписаниеОрганизаций.МаксимальнаяТарифнаяСтавка 
	               |										ТОГДА ЛОЖЬ 
	               |									ИНАЧЕ ИСТИНА 
	               |								  КОНЕЦ 
	               |
	               |						КОГДА ТЧОсновныеНачисления.ВидРасчета.СпособРасчета В (&ЧасовыеРасчеты) 
	               |								И ШтатноеРасписаниеОрганизаций.ВидТарифнойСтавки = &ЧасоваяСтавка 
	               |							ТОГДА ВЫБОР 
	               |									КОГДА ТЧОсновныеНачисления.Показатель1 < ШтатноеРасписаниеОрганизаций.МинимальнаяТарифнаяСтавка 
	               |											ИЛИ ТЧОсновныеНачисления.Показатель1 > ШтатноеРасписаниеОрганизаций.МаксимальнаяТарифнаяСтавка 
	               |										ТОГДА ЛОЖЬ 
	               |									ИНАЧЕ ИСТИНА 
	               |								  КОНЕЦ 
	               |
	               |						ИНАЧЕ ИСТИНА 
	               |					  КОНЕЦ 
	               |			ИНАЧЕ ИСТИНА 
	               |		КОНЕЦ КАК РазмерСоответствуетШТР";
	КонецЕсли;
			   
	ТекстЗапроса = ТекстЗапроса + "
	               |	ИЗ
	               |		Документ.ВводСведенийОПлановыхНачисленияхРаботниковОрганизаций.ОсновныеНачисления КАК ТЧОсновныеНачисления
	               | 
				   |		ЛЕВОЕ СОЕДИНЕНИЕ ВТ_ПоказателиОсновныеНачисления КАК Показатели
				   |			ПО ТЧОсновныеНачисления.НомерСтроки = Показатели.НомерСтроки
				   |
	               |		ЛЕВОЕ СОЕДИНЕНИЕ Документ.ВводСведенийОПлановыхНачисленияхРаботниковОрганизаций.ОсновныеНачисления КАК ПовторяющиесяСтроки
	               |			ПО ТЧОсновныеНачисления.Сотрудник = ПовторяющиесяСтроки.Сотрудник 
	               |				И ТЧОсновныеНачисления.Ссылка = ПовторяющиесяСтроки.Ссылка 
	               |				И ТЧОсновныеНачисления.НомерСтроки < ПовторяющиесяСтроки.НомерСтроки 
	               |				И (ТЧОсновныеНачисления.ВидРасчета = ПовторяющиесяСтроки.ВидРасчета 
	               |					ИЛИ ТЧОсновныеНачисления.ВидРасчета.ЗачетОтработанногоВремени 
	               |						И ПовторяющиесяСтроки.ВидРасчета.ЗачетОтработанногоВремени) 
	               |				И ТЧОсновныеНачисления.ДатаДействия = ПовторяющиесяСтроки.ДатаДействия";
    Если ПроверкаШтатногоРасписания Тогда
		ТекстЗапроса = ТекстЗапроса + "
	               |		ЛЕВОЕ СОЕДИНЕНИЕ " + ШтатноеРасписаниеОрганизацийТекст + " КАК ШтатноеРасписаниеОрганизаций
	               |			ПО ТЧОсновныеНачисления.НомерСтроки = ШтатноеРасписаниеОрганизаций.НомерСтроки";
	КонецЕсли;
	
	ТекстЗапроса = ТекстЗапроса + "
	               |	
	               |	ГДЕ
	               |		ТЧОсновныеНачисления.Ссылка = &ДокументСсылка
	               |	
	               |	СГРУППИРОВАТЬ ПО
	               |		ТЧОсновныеНачисления.НомерСтроки,
	               |		ТЧОсновныеНачисления.Сотрудник,
	               |		ТЧОсновныеНачисления.ВидРасчета,
	               |		ЕСТЬNULL(Показатели.КоличествоПоказателей, 0),
				   |		ТЧОсновныеНачисления.Действие,
	               |		ТЧОсновныеНачисления.ДатаДействия,
	               |		ТЧОсновныеНачисления.ДатаДействияКонец,
	               |		Показатели.Показатель1Наименование,
				   |		Показатели.Показатель2Наименование,
				   |		Показатели.Показатель3Наименование,
				   |		Показатели.Показатель4Наименование,
				   |		Показатели.Показатель5Наименование,
				   |		Показатели.Показатель6Наименование,
				   |		Показатели.Показатель1ТипПоказателя,
				   |		Показатели.Показатель2ТипПоказателя,
				   |		Показатели.Показатель3ТипПоказателя,
				   |		Показатели.Показатель4ТипПоказателя,
				   |		Показатели.Показатель5ТипПоказателя,
				   |		Показатели.Показатель6ТипПоказателя,
				   |		Показатели.Показатель1ВозможностьИзменения,
				   |		Показатели.Показатель2ВозможностьИзменения,
				   |		Показатели.Показатель3ВозможностьИзменения,
				   |		Показатели.Показатель4ВозможностьИзменения,	
				   |		Показатели.Показатель5ВозможностьИзменения,	
				   |		Показатели.Показатель6ВозможностьИзменения,	
	               |		Показатели.Показатель1ЗапрашиватьПриКадровыхПеремещениях,
	               |		Показатели.Показатель2ЗапрашиватьПриКадровыхПеремещениях,
	               |		Показатели.Показатель3ЗапрашиватьПриКадровыхПеремещениях,
	               |		Показатели.Показатель4ЗапрашиватьПриКадровыхПеремещениях,
	               |		Показатели.Показатель5ЗапрашиватьПриКадровыхПеремещениях,
	               |		Показатели.Показатель6ЗапрашиватьПриКадровыхПеремещениях,
				   |		Показатели.Показатель1Предопределенный,
				   |		Показатели.Показатель2Предопределенный,
				   |		Показатели.Показатель3Предопределенный,
				   |		Показатели.Показатель4Предопределенный,
				   |		Показатели.Показатель5Предопределенный,
				   |		Показатели.Показатель6Предопределенный,
				   |		ТЧОсновныеНачисления.Показатель1,
	               |		ТЧОсновныеНачисления.Показатель2,
	               |		ТЧОсновныеНачисления.Показатель3,
	               |		ТЧОсновныеНачисления.Показатель4,
	               |		ТЧОсновныеНачисления.Показатель5,
	               |		ТЧОсновныеНачисления.Показатель6,
				   |		ТЧОсновныеНачисления.ТарифныйРазряд1,
				   |		ТЧОсновныеНачисления.ТарифныйРазряд2,
				   |		ТЧОсновныеНачисления.ТарифныйРазряд3,
				   |		ТЧОсновныеНачисления.ТарифныйРазряд4,
				   |		ТЧОсновныеНачисления.ТарифныйРазряд5,
				   |		ТЧОсновныеНачисления.ТарифныйРазряд6,
	               |		ТЧОсновныеНачисления.Валюта1,
	               |		ТЧОсновныеНачисления.Валюта2,
	               |		ТЧОсновныеНачисления.Валюта3,
	               |		ТЧОсновныеНачисления.Валюта4,
	               |		ТЧОсновныеНачисления.Валюта5,
	               |		ТЧОсновныеНачисления.Валюта6";
    Если ПроверкаШтатногоРасписания Тогда
		ТекстЗапроса = ТекстЗапроса + ",
	               |		ШтатноеРасписаниеОрганизаций.МинимальнаяТарифнаяСтавка,
	               |		ШтатноеРасписаниеОрганизаций.МаксимальнаяТарифнаяСтавка,
	               |		ШтатноеРасписаниеОрганизаций.ВидТарифнойСтавки";
	КонецЕсли;
			   
	ТекстЗапроса = ТекстЗапроса + "
	               |	
	               |	ОБЪЕДИНИТЬ ВСЕ
	               |	
	               |	ВЫБРАТЬ
	               |		ТЧДополнительныеНачисления.НомерСтроки,
	               |		""Дополнительные начисления"",
	               |		ТЧДополнительныеНачисления.Сотрудник,
	               |		ТЧДополнительныеНачисления.ВидРасчета,
	               |		ТЧДополнительныеНачисления.ВидРасчета,
	               |		ТЧДополнительныеНачисления.ВидРасчета.СпособРасчета,
	               |		ВЫБОР 
				   |			КОГДА ТЧДополнительныеНачисления.ВидРасчета.СпособРасчета = ЗНАЧЕНИЕ(Перечисление.СпособыРасчетаОплатыТруда.ПроизвольнаяФормула)
				   |				ТОГДА ИСТИНА
				   |			ИНАЧЕ ЛОЖЬ
				   |		КОНЕЦ,
	               |		ЕСТЬNULL(Показатели.КоличествоПоказателей, 0),
				   |		ЛОЖЬ,
	               |		ТЧДополнительныеНачисления.Действие,
	               |		ТЧДополнительныеНачисления.ДатаДействия,
	               |		ТЧДополнительныеНачисления.ДатаДействияКонец,
	               |		Показатели.Показатель1Наименование КАК Показатель1Наименование,
				   |		Показатели.Показатель2Наименование КАК Показатель2Наименование,
				   |		Показатели.Показатель3Наименование КАК Показатель3Наименование,
				   |		Показатели.Показатель4Наименование КАК Показатель4Наименование,
				   |		Показатели.Показатель5Наименование КАК Показатель5Наименование,
				   |		Показатели.Показатель6Наименование КАК Показатель6Наименование,
				   |		Показатели.Показатель1ТипПоказателя КАК Показатель1ТипПоказателя,
				   |		Показатели.Показатель2ТипПоказателя КАК Показатель2ТипПоказателя,
				   |		Показатели.Показатель3ТипПоказателя КАК Показатель3ТипПоказателя,
				   |		Показатели.Показатель4ТипПоказателя КАК Показатель4ТипПоказателя,
				   |		Показатели.Показатель5ТипПоказателя КАК Показатель5ТипПоказателя,
				   |		Показатели.Показатель6ТипПоказателя КАК Показатель6ТипПоказателя,
				   |		Показатели.Показатель1ВозможностьИзменения КАК Показатель1ВозможностьИзменения,
				   |		Показатели.Показатель2ВозможностьИзменения КАК Показатель2ВозможностьИзменения,
				   |		Показатели.Показатель3ВозможностьИзменения КАК Показатель3ВозможностьИзменения,
				   |		Показатели.Показатель4ВозможностьИзменения КАК Показатель4ВозможностьИзменения,	
				   |		Показатели.Показатель5ВозможностьИзменения КАК Показатель5ВозможностьИзменения,	
				   |		Показатели.Показатель6ВозможностьИзменения КАК Показатель6ВозможностьИзменения,
				   |		Показатели.Показатель1ЗапрашиватьПриКадровыхПеремещениях, 
				   |		Показатели.Показатель2ЗапрашиватьПриКадровыхПеремещениях, 
				   |		Показатели.Показатель3ЗапрашиватьПриКадровыхПеремещениях, 
				   |		Показатели.Показатель4ЗапрашиватьПриКадровыхПеремещениях, 
				   |		Показатели.Показатель5ЗапрашиватьПриКадровыхПеремещениях, 
				   |		Показатели.Показатель6ЗапрашиватьПриКадровыхПеремещениях, 
				   |		Показатели.Показатель1Предопределенный,
				   |		Показатели.Показатель2Предопределенный,
				   |		Показатели.Показатель3Предопределенный,
				   |		Показатели.Показатель4Предопределенный,
				   |		Показатели.Показатель5Предопределенный,
				   |		Показатели.Показатель6Предопределенный,
				   |		ТЧДополнительныеНачисления.Показатель1,
	               |		ТЧДополнительныеНачисления.Показатель2,
	               |		ТЧДополнительныеНачисления.Показатель3,
	               |		ТЧДополнительныеНачисления.Показатель4,
	               |		ТЧДополнительныеНачисления.Показатель5,
	               |		ТЧДополнительныеНачисления.Показатель6,
				   |		ТЧДополнительныеНачисления.ТарифныйРазряд1,
				   |		ТЧДополнительныеНачисления.ТарифныйРазряд2,
				   |		ТЧДополнительныеНачисления.ТарифныйРазряд3,
				   |		ТЧДополнительныеНачисления.ТарифныйРазряд4,
				   |		ТЧДополнительныеНачисления.ТарифныйРазряд5,
				   |		ТЧДополнительныеНачисления.ТарифныйРазряд6,
	               |		ТЧДополнительныеНачисления.Валюта1,
	               |		ТЧДополнительныеНачисления.Валюта2,
	               |		ТЧДополнительныеНачисления.Валюта3,
	               |		ТЧДополнительныеНачисления.Валюта4,
	               |		ТЧДополнительныеНачисления.Валюта5,
	               |		ТЧДополнительныеНачисления.Валюта6,
	               |		МИНИМУМ(ПовторяющиесяСтроки.НомерСтроки)";
    Если ПроверкаШтатногоРасписания Тогда
		ТекстЗапроса = ТекстЗапроса + ",
	               |		ИСТИНА";
	КонецЕсли;
			   
	ТекстЗапроса = ТекстЗапроса + "
	               |	ИЗ
	               |		Документ.ВводСведенийОПлановыхНачисленияхРаботниковОрганизаций.ДополнительныеНачисления КАК ТЧДополнительныеНачисления
	               |
				   |		ЛЕВОЕ СОЕДИНЕНИЕ ВТ_ПоказателиДополнительныеНачисления КАК Показатели
				   |			ПО ТЧДополнительныеНачисления.НомерСтроки = Показатели.НомерСтроки
				   |
	               |		ЛЕВОЕ СОЕДИНЕНИЕ Документ.ВводСведенийОПлановыхНачисленияхРаботниковОрганизаций.ДополнительныеНачисления КАК ПовторяющиесяСтроки
	               |			ПО ТЧДополнительныеНачисления.Сотрудник = ПовторяющиесяСтроки.Сотрудник 
	               |				И ТЧДополнительныеНачисления.Ссылка = ПовторяющиесяСтроки.Ссылка 
	               |				И ТЧДополнительныеНачисления.НомерСтроки < ПовторяющиесяСтроки.НомерСтроки 
	               |				И ТЧДополнительныеНачисления.ВидРасчета = ПовторяющиесяСтроки.ВидРасчета 
	               |				И ТЧДополнительныеНачисления.ДатаДействия = ПовторяющиесяСтроки.ДатаДействия
	               |	
	               |	ГДЕ
	               |		ТЧДополнительныеНачисления.Ссылка = &ДокументСсылка
	               |	
	               |	СГРУППИРОВАТЬ ПО
	               |		ТЧДополнительныеНачисления.НомерСтроки,
	               |		ТЧДополнительныеНачисления.Сотрудник,
	               |		ТЧДополнительныеНачисления.ВидРасчета,
	               |		ЕСТЬNULL(Показатели.КоличествоПоказателей, 0),
				   |		ТЧДополнительныеНачисления.Действие,
	               |		ТЧДополнительныеНачисления.ДатаДействия,
	               |		ТЧДополнительныеНачисления.ДатаДействияКонец,
	               |		Показатели.Показатель1Наименование,
				   |		Показатели.Показатель2Наименование,
				   |		Показатели.Показатель3Наименование,
				   |		Показатели.Показатель4Наименование,
				   |		Показатели.Показатель5Наименование,
				   |		Показатели.Показатель6Наименование,
				   |		Показатели.Показатель1ТипПоказателя,
				   |		Показатели.Показатель2ТипПоказателя,
				   |		Показатели.Показатель3ТипПоказателя,
				   |		Показатели.Показатель4ТипПоказателя,
				   |		Показатели.Показатель5ТипПоказателя,
				   |		Показатели.Показатель6ТипПоказателя,
				   |		Показатели.Показатель1ВозможностьИзменения,
				   |		Показатели.Показатель2ВозможностьИзменения,
				   |		Показатели.Показатель3ВозможностьИзменения,
				   |		Показатели.Показатель4ВозможностьИзменения,	
				   |		Показатели.Показатель5ВозможностьИзменения,	
				   |		Показатели.Показатель6ВозможностьИзменения,	
				   |		Показатели.Показатель1ЗапрашиватьПриКадровыхПеремещениях, 
				   |		Показатели.Показатель2ЗапрашиватьПриКадровыхПеремещениях, 
				   |		Показатели.Показатель3ЗапрашиватьПриКадровыхПеремещениях, 
				   |		Показатели.Показатель4ЗапрашиватьПриКадровыхПеремещениях, 
				   |		Показатели.Показатель5ЗапрашиватьПриКадровыхПеремещениях, 
				   |		Показатели.Показатель6ЗапрашиватьПриКадровыхПеремещениях, 
				   |		Показатели.Показатель1Предопределенный,
				   |		Показатели.Показатель2Предопределенный,
				   |		Показатели.Показатель3Предопределенный,
				   |		Показатели.Показатель4Предопределенный,
				   |		Показатели.Показатель5Предопределенный,
				   |		Показатели.Показатель6Предопределенный,
	               |		ТЧДополнительныеНачисления.Показатель1,
	               |		ТЧДополнительныеНачисления.Показатель2,
	               |		ТЧДополнительныеНачисления.Показатель3,
	               |		ТЧДополнительныеНачисления.Показатель4,
	               |		ТЧДополнительныеНачисления.Показатель5,
	               |		ТЧДополнительныеНачисления.Показатель6,
	               |		ТЧДополнительныеНачисления.Валюта1,
	               |		ТЧДополнительныеНачисления.Валюта2,
	               |		ТЧДополнительныеНачисления.Валюта3,
	               |		ТЧДополнительныеНачисления.Валюта4,
	               |		ТЧДополнительныеНачисления.Валюта5,
	               |		ТЧДополнительныеНачисления.Валюта6,
				   |		ТЧДополнительныеНачисления.ТарифныйРазряд1,
				   |		ТЧДополнительныеНачисления.ТарифныйРазряд2,
				   |		ТЧДополнительныеНачисления.ТарифныйРазряд3,
				   |		ТЧДополнительныеНачисления.ТарифныйРазряд4,
				   |		ТЧДополнительныеНачисления.ТарифныйРазряд5,
				   |		ТЧДополнительныеНачисления.ТарифныйРазряд6,
	               |		ТЧДополнительныеНачисления.ВидРасчета) КАК Начисления
	               |
	               |	ЛЕВОЕ СОЕДИНЕНИЕ РегистрСведений.ПлановыеНачисленияРаботниковОрганизаций КАК СуществующиеДвижения
	               |		ПО Начисления.Сотрудник = СуществующиеДвижения.Сотрудник 
	               |			И (СуществующиеДвижения.Организация = &ГоловнаяОрганизация) 
	               |			И Начисления.ДатаДействия = СуществующиеДвижения.Период 
	               |			И Начисления.ВидРасчетаИзмерение = СуществующиеДвижения.ВидРасчетаИзмерение";
			   
	
	Запрос.Текст = ТекстЗапроса;
	
	Запрос.УстановитьПараметр("ВалютаРегУчета", Константы.ВалютаРегламентированногоУчета.Получить());	
		
	Возврат Запрос.Выполнить();

КонецФункции

// Проверяет правильность заполнения шапки документа.
// Если какой-то из реквизтов шапки, влияющий на проведение не заполнен или
// заполнен не корректно, то выставляется флаг отказа в проведении.
// Проверка выполняется по выборке из результата запроса по шапке,
// все проверяемые реквизиты должны быть включены в выборку по шапке.
//
// Параметры: 
//  ВыборкаПоШапкеДокумента	- выборка из результата запроса по шапке документа,
//  Отказ 					- флаг отказа в проведении.
//	Заголовок				- Заголовок для сообщений об ошибках проведения
//
Процедура ПроверитьЗаполнениеШапки(ВыборкаПоШапкеДокумента, Отказ, Заголовок)

	Если НЕ ЗначениеЗаполнено(ВыборкаПоШапкеДокумента.Организация) Тогда
		ОбщегоНазначения.ОшибкаПриПроведении("Не указана организация!", Отказ, Заголовок);
	КонецЕсли;

КонецПроцедуры // ПроверитьЗаполнениеШапки()

// Проверяет правильность заполнения реквизитов в строке ТЧ "РаботникиОрганизации" документа.
// Если какой-то из реквизтов, влияющий на проведение не заполнен или
// заполнен не корректно, то выставляется флаг отказа в проведении.
// Проверка выполняется по выборке из результата запроса по строке ТЧ документа,
// все проверяемые реквизиты должны быть включены в выборку.
//
// Параметры: 
//  ВыборкаПоШапкеДокумента		- выборка из результата запроса по шапке документа,
//  ВыборкаПоСтрокамДокумента	- спозиционированная на определеной строке выборка 
//  							  из результата запроса
//  Отказ 						- флаг отказа в проведении.
//
Процедура ПроверитьЗаполнениеСтрокиРаботникаОрганизации(ВыборкаПоШапкеДокумента, ВыборкаПоСтрокамДокумента, Отказ, Заголовок, УчетнаяПолитикаПоПерсоналуОрганизации)

	СтрокаНачалаСообщенияОбОшибке = "В строке номер """+ СокрЛП(ВыборкаПоСтрокамДокумента.НомерСтроки) +
									""" табл. части """ + ВыборкаПоСтрокамДокумента.ВидСтроки + """: ";
	
	// Сотрудник
    ЕстьСотрудник = ЗначениеЗаполнено(ВыборкаПоСтрокамДокумента.Сотрудник);
	Если НЕ ЕстьСотрудник Тогда
		ОбщегоНазначения.ОшибкаПриПроведении(СтрокаНачалаСообщенияОбОшибке + "не выбран сотрудник!", Отказ, Заголовок);
	КонецЕсли;
	
	// Организация сотрудника должна совпадать с организацией документа
	Если ВыборкаПоСтрокамДокумента.ОшибкаНеСоответствиеСотрудникаИОрганизации Тогда
		ОбщегоНазначения.ОшибкаПриПроведении(СтрокаНачалаСообщенияОбОшибке + "организация документа не соответствует организации, указанной в карточке сотрудника!", Отказ, Заголовок);
	КонецЕсли;
	
	// Действие
	Если НЕ ЗначениеЗаполнено(ВыборкаПоСтрокамДокумента.Действие) Тогда
		ОбщегоНазначения.ОшибкаПриПроведении(СтрокаНачалаСообщенияОбОшибке + "не задано действие!", Отказ, Заголовок);
	КонецЕсли;

	Если ВыборкаПоСтрокамДокумента.Действие <> Перечисления.ВидыДействияСНачислением.НеИзменять Тогда
		
		// Вид расчета
		Если НЕ ЗначениеЗаполнено(ВыборкаПоСтрокамДокумента.ВидРасчета) Тогда
			ОбщегоНазначения.ОшибкаПриПроведении(СтрокаНачалаСообщенияОбОшибке + "не задан вид расчета!", Отказ, Заголовок);
		ИначеЕсли (ВыборкаПоСтрокамДокумента.Действие = Перечисления.ВидыДействияСНачислением.Начать или ВыборкаПоСтрокамДокумента.Действие = Перечисления.ВидыДействияСНачислением.Изменить) Тогда 	
			
			ИспользуютсяНачисленияВВалюте			= УчетнаяПолитикаПоПерсоналуОрганизации[Организация].ИспользуютсяНачисленияВВалюте;
			ПроведениеРасчетов.ПроверкаПоказателейВПлановыхНачислениях(ВыборкаПоСтрокамДокумента, СтрокаНачалаСообщенияОбОшибке, Истина, Отказ, Заголовок, ИспользуютсяНачисленияВВалюте, СоответствиеВалютныеСпособыРасчета);
			
			// Соответствие размера "основного" начисления штатному расписанию
			Если УчетнаяПолитикаПоПерсоналуОрганизации[Организация].ПроверкаШтатногоРасписания и Не ВыборкаПоСтрокамДокумента.РазмерСоответствуетШТР и Не ВыборкаПоСтрокамДокумента.ТребуетВводаТарифногоРазряда Тогда
				ОбщегоНазначения.ОшибкаПриПроведении(СтрокаНачалаСообщенияОбОшибке + "размер основного начисления не соответствует штатному расписанию!", Отказ, Заголовок);
			КонецЕсли;
			
		КонецЕсли;

		// ДатаДействия
		Если НЕ ЗначениеЗаполнено(ВыборкаПоСтрокамДокумента.ДатаДействия) Тогда
			ОбщегоНазначения.ОшибкаПриПроведении(СтрокаНачалаСообщенияОбОшибке + "не задана дата действия!", Отказ, Заголовок);
		ИначеЕсли ЗначениеЗаполнено(ВыборкаПоСтрокамДокумента.КонфликтныйДокумент) Тогда
			// Движения в регистре на дату из документа
			ОбщегоНазначения.ОшибкаПриПроведении(СтрокаНачалаСообщенияОбОшибке + "на дату "+ ВыборкаПоСтрокамДокумента.ДатаДействия + " начисление уже зарегистрировано документом " + ВыборкаПоСтрокамДокумента.КонфликтныйДокумент + "!", Отказ, Заголовок);
		КонецЕсли;
		
		// Одинаковые строки
		Если ЗначениеЗаполнено(ВыборкаПоСтрокамДокумента.КонфликтнаяСтрокаНомер) Тогда
			 Если ВыборкаПоСтрокамДокумента.ОсновноеНачисление Тогда
				 СтрокаСообщениеОбОшибке = "основное начисление сотрудника " + ВыборкаПоСтрокамДокумента.СотрудникНаименование + " следует редактировать в одной строке (см. строку " + ВыборкаПоСтрокамДокумента.КонфликтнаяСтрокаНомер + ")!"; 
			 Иначе
				 СтрокаСообщениеОбОшибке = "сотруднику " + ВыборкаПоСтрокамДокумента.СотрудникНаименование + " не может быть назначено одно и тоже начисление дважды (см. строку " + ВыборкаПоСтрокамДокумента.КонфликтнаяСтрокаНомер + ")!"; 
			 КонецЕсли;
			 ОбщегоНазначения.ОшибкаПриПроведении(СтрокаНачалаСообщенияОбОшибке  + СтрокаСообщениеОбОшибке, Отказ, Заголовок);
		КонецЕсли;
		
	КонецЕсли; 
		
КонецПроцедуры // ПроверитьЗаполнениеСтрокиРаботникаОрганизации()

// Создает и заполняет структуру, содержащую имена регистров сведений 
//  по которым надо проводить документ
//
// Параметры: 
//  СтруктураПроведенияПоРегистрамСведений - структура, содержащая имена регистров сведений 
//                                           по которым надо проводить документ
//
// Возвращаемое значение:
//  Нет.
//
Процедура ЗаполнитьСтруктуруПроведенияПоРегистрамСведений(ВыборкаПоШапкеДокумента, СтруктураПроведенияПоРегистрамСведений)

	СтруктураПроведенияПоРегистрамСведений = Новый Структура();
	СтруктураПроведенияПоРегистрамСведений.Вставить("ПлановыеНачисленияРаботниковОрганизаций");

КонецПроцедуры // ЗаполнитьСтруктуруПроведенияПоРегистрамСведений

// По строке выборки результата запроса по документу формируем движения по регистрам
//
// Параметры: 
//  ВыборкаПоШапкеДокумента                - выборка из результата запроса по шапке документа,
//  СтруктураПроведенияПоРегистрамСведений - структура, содержащая имена регистров 
//                                           сведений по которым надо проводить документ,
//  СтруктураПараметров                    - структура параметров проведения,
//
// Возвращаемое значение:
//  Нет.
//
Процедура ДобавитьСтрокуВДвиженияПоРегистрамСведений(ВыборкаПоШапкеДокумента, ВыборкаПоРаботникиОрганизации, 
	
	СтруктураПроведенияПоРегистрамСведений, СтруктураПараметров = "", УчетнаяПолитикаПоПерсоналуОрганизации)

	// Если документ нужно проводить по регистру, то для него есть ключ в структуре
	ИмяРегистра = "ПлановыеНачисленияРаботниковОрганизаций";
	Если СтруктураПроведенияПоРегистрамСведений.Свойство(ИмяРегистра) Тогда

		Если ВыборкаПоРаботникиОрганизации.Действие <> Перечисления.ВидыДействияСНачислением.НеИзменять тогда
			
			Движение = Движения[ИмяРегистра].Добавить();
			
			// Свойства
			Движение.Период                 = ВыборкаПоРаботникиОрганизации.ДатаДействия;
		
			// Измерения
			Движение.Сотрудник              = ВыборкаПоРаботникиОрганизации.Сотрудник;
			Движение.Организация			= ВыборкаПоШапкеДокумента.ГоловнаяОрганизация;			
			Если НЕ ВыборкаПоРаботникиОрганизации.ОсновноеНачисление Тогда
				Движение.ВидРасчетаИзмерение = ВыборкаПоРаботникиОрганизации.ВидРасчета;
			КонецЕсли; 
			
			// Ресурсы
			Движение.Действие		        = ВыборкаПоРаботникиОрганизации.Действие;
			Движение.ВидРасчета             = ВыборкаПоРаботникиОрганизации.ВидРасчета;
			Если ВыборкаПоРаботникиОрганизации.Действие <> Перечисления.ВидыДействияСНачислением.Прекратить Тогда
				Движение.ТарифныйРазряд1	= ВыборкаПоРаботникиОрганизации.ТарифныйРазряд1;
				Движение.ТарифныйРазряд2	= ВыборкаПоРаботникиОрганизации.ТарифныйРазряд2;
				Движение.ТарифныйРазряд3	= ВыборкаПоРаботникиОрганизации.ТарифныйРазряд3;
				Движение.ТарифныйРазряд4	= ВыборкаПоРаботникиОрганизации.ТарифныйРазряд4;
				Движение.ТарифныйРазряд5	= ВыборкаПоРаботникиОрганизации.ТарифныйРазряд5;
				Движение.ТарифныйРазряд6	= ВыборкаПоРаботникиОрганизации.ТарифныйРазряд6;
				Движение.Показатель1		= ВыборкаПоРаботникиОрганизации.Показатель1;
				Движение.Показатель2		= ВыборкаПоРаботникиОрганизации.Показатель2;
				Движение.Показатель3		= ВыборкаПоРаботникиОрганизации.Показатель3;
				Движение.Показатель4		= ВыборкаПоРаботникиОрганизации.Показатель4;
				Движение.Показатель5		= ВыборкаПоРаботникиОрганизации.Показатель5;
				Движение.Показатель6		= ВыборкаПоРаботникиОрганизации.Показатель6;
				Движение.Валюта1			= ВыборкаПоРаботникиОрганизации.Валюта1;
				Движение.Валюта2			= ВыборкаПоРаботникиОрганизации.Валюта2;
				Движение.Валюта3			= ВыборкаПоРаботникиОрганизации.Валюта3;
				Движение.Валюта4			= ВыборкаПоРаботникиОрганизации.Валюта4;
				Движение.Валюта5			= ВыборкаПоРаботникиОрганизации.Валюта5;
				Движение.Валюта6			= ВыборкаПоРаботникиОрганизации.Валюта6;
			КонецЕсли; 
            Если ЗначениеЗаполнено(ВыборкаПоРаботникиОрганизации.ДатаДействияКонец) Тогда 
    			Движение.ПериодЗавершения   = ВыборкаПоРаботникиОрганизации.ДатаДействияКонец;
    			Движение.ДействиеЗавершения	= Перечисления.ВидыДействияСНачислением.Прекратить;
                Движение.ВидРасчетаЗавершения = ВыборкаПоРаботникиОрганизации.ВидРасчета;
                // не заполняются
                //ПоказательЗавершения
                //ВалютаЗавершения
                //ТарифныйРазрядЗавершения
            КонецЕсли; 
			
		КонецЕсли;

	КонецЕсли; 
	
КонецПроцедуры // ДобавитьСтрокуВДвиженияПоРегистрамСведений

////////////////////////////////////////////////////////////////////////////////
// ОБРАБОТЧИКИ СОБЫТИЙ

Процедура ОбработкаПроведения(Отказ, Режим)
	
	//структура, содержащая имена регистров сведений по которым надо проводить документ
	Перем СтруктураПроведенияПоРегистрамСведений;
	
	// Заголовок для сообщений об ошибках проведения.
	Заголовок = ОбщегоНазначения.ПредставлениеДокументаПриПроведении(Ссылка);
	
	// Проверка ручной корректировки
	Если ОбщегоНазначения.РучнаяКорректировкаОбработкаПроведения(РучнаяКорректировка,Отказ,Заголовок,ЭтотОбъект) Тогда
		Возврат
	КонецЕсли;

	СоответствиеВалютныеСпособыРасчета = ПроведениеРасчетов.ПолучитьСоответствиеСпособовРасчетаТребующихВалюту();
	РезультатЗапросаПоШапке = СформироватьЗапросПоШапке(Режим);

	// Получим реквизиты шапки из запроса
	ВыборкаПоШапкеДокумента = РезультатЗапросаПоШапке.Выбрать();

	Если ВыборкаПоШапкеДокумента.Следующий() Тогда

		//Надо позвать проверку заполнения реквизитов шапки
		ПроверитьЗаполнениеШапки(ВыборкаПоШапкеДокумента, Отказ, Заголовок);

		// Движения стоит добавлять, если в проведении еще не отказано (отказ =ложь)
		Если НЕ Отказ Тогда

			// Создадим и заполним структуры, содержащие имена регистров, по которым в зависимости от типа учета
			// проводится документ. В дальнейшем будем считать, что если для регистра не создан ключ в структуре,
			// то проводить по нему не надо.
			ЗаполнитьСтруктуруПроведенияПоРегистрамСведений(ВыборкаПоШапкеДокумента, СтруктураПроведенияПоРегистрамСведений);

			// получим реквизиты табличной части
			РезультатЗапросаПоРаботники = СформироватьЗапросПоРаботникиОрганизации(ВыборкаПоШапкеДокумента);
			ВыборкаПоРаботникиОрганизации = РезультатЗапросаПоРаботники.Выбрать(ОбходРезультатаЗапроса.ПоГруппировкам);
			УчетнаяПолитикаПоПерсоналуОрганизации = глЗначениеПеременной("глУчетнаяПолитикаПоПерсоналуОрганизации");

			Пока ВыборкаПоРаботникиОрганизации.Следующий() Цикл 

				// проверим очередную строку табличной части
				ПроверитьЗаполнениеСтрокиРаботникаОрганизации(ВыборкаПоШапкеДокумента, ВыборкаПоРаботникиОрганизации, Отказ, Заголовок, УчетнаяПолитикаПоПерсоналуОрганизации);

				Если НЕ Отказ Тогда

					// Заполним записи в наборах записей регистров
					ДобавитьСтрокуВДвиженияПоРегистрамСведений(ВыборкаПоШапкеДокумента, ВыборкаПоРаботникиОрганизации, СтруктураПроведенияПоРегистрамСведений, , УчетнаяПолитикаПоПерсоналуОрганизации);
					
				КонецЕсли;
			КонецЦикла;
		КонецЕсли; 
	КонецЕсли;

КонецПроцедуры

Процедура ПередЗаписью(Отказ, РежимЗаписи, РежимПроведения)
	
	Если ОбменДанными.Загрузка Тогда
		Возврат
	КонецЕсли;
	
	МассивТЧ = Новый Массив();
	МассивТЧ.Добавить(ОсновныеНачисления);
	МассивТЧ.Добавить(ДополнительныеНачисления);
	
	КраткийСоставДокумента = ПроцедурыУправленияПерсоналом.ЗаполнитьКраткийСоставДокумента(МассивТЧ);
	
КонецПроцедуры

Процедура ОбработкаЗаполнения(ДанныеЗаполнения, СтандартнаяОбработка)
	
	ТипОснования = ТипЗнч(ДанныеЗаполнения);
	
	Если ТипОснования = Тип("СправочникСсылка.СотрудникиОрганизаций") Тогда
		
		// Заполним реквизиты из стандартного набора.
		ЗаполнениеДокументов.ЗаполнитьШапкуДокументаПоОснованию(ЭтотОбъект, ДанныеЗаполнения);
		Дата = ОбщегоНазначения.ПолучитьРабочуюДату();
		
		ДобавитьСтрокиНачисленийПоРаботнику(ДанныеЗаполнения);
		
		Запрос = Новый Запрос;
		Запрос.УстановитьПараметр("Сотрудник", ДанныеЗаполнения);
		Запрос.УстановитьПараметр("ДатаАктуальности", ОбщегоНазначения.ПолучитьРабочуюДату());
		Запрос.Текст =
		"ВЫБРАТЬ
		|	РаботникиОрганизации.ОбособленноеПодразделение КАК Организация
		|ИЗ
		|	РегистрСведений.РаботникиОрганизаций.СрезПоследних(&ДатаАктуальности, Сотрудник = &Сотрудник) КАК РаботникиОрганизации";
		Выборка = Запрос.Выполнить().Выбрать();
		Если Выборка.Следующий() Тогда
			Организация = Выборка.Организация
		Иначе 
			Организация = ДанныеЗаполнения.СтруктурнаяЕдиница;
		КонецЕсли;
	КонецЕсли;
	
	ДокументОснование = ДанныеЗаполнения;
	
КонецПроцедуры

мВалютаРегламентированногоУчета = Константы.ВалютаРегламентированногоУчета.Получить();