#Если Сервер Или ТолстыйКлиентОбычноеПриложение Или ВнешнееСоединение Тогда

////////////////////////////////////////////////////////////////////////////////
// ПРОГРАММНЫЙ ИНТЕРФЕЙС

////////////////////////////////////////////////////////////////////////////////
// ОБРАБОТЧИКИ СОБЫТИЙ

Процедура ОбработкаЗаполнения(ДанныеЗаполнения, СтандартнаяОбработка)
	
	фин_ЗаполнениеДокументов.ЗаполнитьШапкуДокумента(ЭтотОбъект, , , , , ДанныеЗаполнения);

КонецПроцедуры

Процедура ПередЗаписью(Отказ, РежимЗаписи, РежимПроведения)
	
	Если ОбменДанными.Загрузка Тогда
		Возврат;
	КонецЕсли;
	
КонецПроцедуры

Процедура ПриЗаписи(Отказ)
	
	Если Не НеУчитыватьГрафикПлатежныхДней Тогда
		Запрос = Новый Запрос;
		Запрос.Текст = 
		"ВЫБРАТЬ
		|	ПланПлатежейПлатежи.НомерСтроки,
		|	ПланПлатежейПлатежи.ДатаПлатежа,
		|	ЕСТЬNULL(ГрафикПлатежныхДней.ВидДня, ЗНАЧЕНИЕ(Перечисление.ден_ВидыДнейГрафикаПлатежныхДней.ПустаяСсылка)) КАК ВидДня
		|ИЗ
		|	Документ.ден_ПланПлатежей.Платежи КАК ПланПлатежейПлатежи
		|		ЛЕВОЕ СОЕДИНЕНИЕ РегистрСведений.ден_ГрафикПлатежныхДней КАК ГрафикПлатежныхДней
		|		ПО ПланПлатежейПлатежи.Ссылка.Организация = ГрафикПлатежныхДней.Организация
		|			И (ПланПлатежейПлатежи.ДатаПлатежа = ГрафикПлатежныхДней.ДатаКалендаря)
		|ГДЕ
		|	ПланПлатежейПлатежи.Ссылка = &Ссылка
		|	И ЕСТЬNULL(ГрафикПлатежныхДней.ВидДня, ЗНАЧЕНИЕ(Перечисление.ден_ВидыДнейГрафикаПлатежныхДней.ПустаяСсылка)) <> ЗНАЧЕНИЕ(Перечисление.ден_ВидыДнейГрафикаПлатежныхДней.Платежный)";
		Запрос.УстановитьПараметр("Ссылка", Ссылка);
		Результат = Запрос.Выполнить();
		Выборка = Результат.Выбрать();
		Пока Выборка.Следующий() Цикл
			ТекстСообщения = "В строке номер " + Выборка.НомерСтроки + " дата платежа не является платежной датой по графику платежных дней.";
			ОбщегоНазначенияКлиентСервер.СообщитьПользователю(ТекстСообщения);
		КонецЦикла;
	КонецЕсли;

КонецПроцедуры

Процедура ОбработкаПроведения(Отказ, РежимПроведения)
	
	// ПОДГОТОВКА ПРОВЕДЕНИЯ ПО ДАННЫМ ДОКУМЕНТА
	фин_ПроведениеСервер.ПодготовитьНаборыЗаписейКПроведению(ЭтотОбъект);
	Если РучнаяКорректировка Тогда
		Возврат;
	КонецЕсли;
	
КонецПроцедуры

////////////////////////////////////////////////////////////////////////////////
// СЛУЖЕБНЫЕ ПРОЦЕДУРЫ И ФУНКЦИИ

#КонецЕсли