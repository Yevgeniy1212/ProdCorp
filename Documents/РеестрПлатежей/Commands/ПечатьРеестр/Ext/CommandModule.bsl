
&НаКлиенте
Процедура ОбработкаКоманды(ПараметрКоманды, ПараметрыВыполненияКоманды)
	ТабДок = Новый ТабличныйДокумент;
	ПечатьРесстр(ПараметрКоманды,ТабДок);
	КоличествоЭкземпляров = 1;
	НаПринтер = Ложь;
	УниверсальныеМеханизмы.НапечататьДокумент(ТабДок, КоличествоЭкземпляров, НаПринтер, РаботаСДиалогами.СформироватьЗаголовокДокумента(ПараметрКоманды,"Реестр платежей "));	
КонецПроцедуры

&НаСервере
Процедура ПечатьРесстр(ПараметрКоманды,ТабДок)
	ТабДок.Очистить();
	// Получаем валюты чтоб рассчитать курс
	KZT = Справочники.Валюты.НайтиПоКоду("398");
	USD = Справочники.Валюты.НайтиПоКоду("840");
	RUB = Справочники.Валюты.НайтиПоКоду("643");
	
	Макет     = Документы.РеестрПлатежей.ПолучитьМакет("Реестр");
	Шапка     = Макет.ПолучитьОбласть("Шапка");
	ОблСтрока = Макет.ПолучитьОбласть("Строки");
	Подвал    = Макет.ПолучитьОбласть("Подвал");
	
	Шапка.Параметры.Дата = Формат(ПараметрКоманды.ДатаОкончания,"ДФ=dd.MM.yyyy");
	ТабДок.Вывести(Шапка);
	
	Запрос = Новый Запрос;
	Запрос.Текст = 
	"ВЫБРАТЬ
	|	РеестрПлатежейПлатежи.Ссылка,
	|	РеестрПлатежейПлатежи.НомерСтроки,
	|	РеестрПлатежейПлатежи.Поручение,
	|	РеестрПлатежейПлатежи.Контрагент,
	|	РеестрПлатежейПлатежи.Договор,
	|	РеестрПлатежейПлатежи.НазначениеПлатежа,
	|	РеестрПлатежейПлатежи.СуммаПлатежа,
	|	РеестрПлатежейПлатежи.РасчетныйСчет,
	|	РеестрПлатежейПлатежи.Представительство,
	|	РеестрПлатежейПлатежи.Валюта
	|ИЗ
	|	Документ.РеестрПлатежей.Платежи КАК РеестрПлатежейПлатежи
	|ГДЕ
	|	РеестрПлатежейПлатежи.Ссылка = &Ссылка";
	
	Запрос.УстановитьПараметр("Ссылка", ПараметрКоманды);
	
	РезультатЗапроса = Запрос.Выполнить();
	
	Выборка = РезультатЗапроса.Выбрать();
	
    НомерСтроки = 0;
	СуммаТенге  = 0;
	СуммаДоллор = 0;
	СуммаРубль  = 0;
	
	Пока Выборка.Следующий() Цикл 
		
		ОблСтрока.Параметры.Заполнить(Выборка);
		
		Если НЕ ЗначениеЗаполнено(Выборка.Представительство) Тогда
			ОблСтрока.Параметры.Представительство = "";
		КонецЕсли;
		
		Если Выборка.Валюта = KZT Тогда 
			ОблСтрока.Параметры.СуммаТг = Выборка.СуммаПлатежа;
			СуммаТенге = СуммаТенге + Выборка.СуммаПлатежа;
			ОблСтрока.Параметры.СуммаД = "";
			ОблСтрока.Параметры.СуммаРб = "";
			
		ИначеЕсли Выборка.Валюта = USD Тогда
			ОблСтрока.Параметры.СуммаД = Выборка.СуммаПлатежа;
			СуммаДоллор = СуммаДоллор + Выборка.СуммаПлатежа;
			ОблСтрока.Параметры.СуммаРб = "";
			ОблСтрока.Параметры.СуммаТг = "";
		Иначе
			ОблСтрока.Параметры.СуммаРб = Выборка.СуммаПлатежа;
			СуммаРубль = СуммаРубль + Выборка.СуммаПлатежа;
			ОблСтрока.Параметры.СуммаД = "";
			ОблСтрока.Параметры.СуммаТг = "";
		КонецЕсли;
		
		ОблСтрока.Параметры.НомерПП = Выборка.Поручение.Номер;
		
		ТабДок.Вывести(ОблСтрока);
		
	КонецЦикла;
	
	// выводим итоговые суммы 	
	Подвал.Параметры.ИтогоТг = СуммаТенге;
	Подвал.Параметры.ИтогоД  = СуммаДоллор;
	Подвал.Параметры.ИтогоРб = СуммаРубль;
	
	// Получаем руководитель 
	ДолжностьРуководителя = Перечисления.ОтветственныеЛицаОрганизаций.Руководитель;
    Отбор = Новый Структура("ОтветственноеЛицо", ДолжностьРуководителя);
    //Руководитель = РегистрыСведений.ОтветственныеЛицаОрганизаций.ПолучитьПоследнее(ПараметрКоманды.Дата,Отбор);
	
	// Фин дир
	ДолжностьФинДиректора = "Директор Финансового департамента";
	ФинДир = "А. Мукашова";
	
	Подвал.Параметры.ДолжностьРуководителя = ДолжностьРуководителя;
	Подвал.Параметры.ФИОРуководителя = "М. Джауханов";
	Подвал.Параметры.ФИОФиндира =  ФинДир;
	Подвал.Параметры.ДолжностьФиндира = ДолжностьФинДиректора;
	
	Подвал.Параметры.Исполнитель = ПараметрКоманды.Исполнитель;
	Подвал.Параметры.Телефон = ПараметрКоманды.Телефон;
	
	Подвал.Параметры.Дата1 = Формат(ПараметрКоманды.Дата,"ДФ=dd.MM.yyyy");
	Подвал.Параметры.Время = Формат(ПараметрКоманды.Дата,"ДЛФ=T");
	
	ТабДок.Вывести(Подвал);
КонецПроцедуры	
