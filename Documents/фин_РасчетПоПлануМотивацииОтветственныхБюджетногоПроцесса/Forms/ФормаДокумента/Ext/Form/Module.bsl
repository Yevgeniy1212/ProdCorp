
////////////////////////////////////////////////////////////////////////////////
// ОБРАБОТЧИКИ СОБЫТИЙ ФОРМЫ

&НаСервере
Процедура ПриСозданииНаСервере(Отказ, СтандартнаяОбработка)
	
	фин_ПроцедрыРаботыСОбъектамиПереопределяемый.ДокументПриСозданииНаСервере(ЭтотОбъект);
	
	ПодготовитьФормуНаСервере();
	фин_ПроцедрыРаботыСОбъектамиПереопределяемый.УстановитьЗаголовокФормыДокумента("", Объект.Ссылка, ЭтотОбъект);
	
КонецПроцедуры

&НаСервере
Процедура ПриЧтенииНаСервере(ТекущийОбъект)
	
	фин_ПроцедрыРаботыСОбъектамиПереопределяемый.ДокументПриЧтенииНаСервере(ЭтотОбъект,ТекущийОбъект);
	
КонецПроцедуры

&НаКлиенте
Процедура ПослеЗаписи(ПараметрыЗаписи)
	
	Оповестить("Запись_фин_РасчетПоПлануМотивацииОтветственныхБюджетногоПроцесса", ПараметрыЗаписи, Объект.Ссылка);	
	
КонецПроцедуры

&НаСервере
Процедура ПослеЗаписиНаСервере(ТекущийОбъект, ПараметрыЗаписи)

	фин_ПроцедрыРаботыСОбъектамиПереопределяемый.УстановитьЗаголовокФормыДокумента("", Объект.Ссылка, ЭтотОбъект);
	
КонецПроцедуры

&НаКлиенте
Процедура ОбработкаОповещения(ИмяСобытия, Параметр, Источник)
	
	общ_ОбщегоНазначенияКлиент.ОбработкаОповещенияФормыДокумента(ЭтотОбъект, Объект.Ссылка, ИмяСобытия, Параметр, Источник);

КонецПроцедуры

////////////////////////////////////////////////////////////////////////////////
// ОБРАБОТЧИКИ СОБЫТИЙ ЭЛЕМЕНТОВ ШАПКИ ФОРМЫ

&НаКлиенте
Процедура КомментарийНачалоВыбора(Элемент, ДанныеВыбора, СтандартнаяОбработка)
	фин_ПроцедурыРаботыСОбъектамиКлиентПереопределяемый.ПоказатьФормуРедактированияКомментария(Элемент.ТекстРедактирования, ЭтотОбъект, "Объект.Комментарий");
КонецПроцедуры

&НаКлиенте
Процедура ДатаПриИзменении(Элемент)
	
	Если НачалоДня(Объект.Дата) = НачалоДня(ТекущаяДатаДокумента) Тогда
		// Изменение времени не влияет на поведение документа.
		ТекущаяДатаДокумента = Объект.Дата;
		Возврат;
	КонецЕсли;
	
	// Запомним новую дату документа.
	ТекущаяДатаДокумента = Объект.Дата;
	
КонецПроцедуры


////////////////////////////////////////////////////////////////////////////////
// ОБРАБОТЧИКИ СОБЫТИЙ ТАБЛИЦЫ ФОРМЫ <>



////////////////////////////////////////////////////////////////////////////////
// ОБРАБОТЧИКИ КОМАНД ФОРМЫ

// СтандартныеПодсистемы.Печать
&НаКлиенте
Процедура Подключаемый_ВыполнитьКомандуПечати(Команда)
	фин_ПроцедурыРаботыСОбъектамиКлиентПереопределяемый.ВыполнитьПодключаемуюКомандуПечати(Команда, ЭтотОбъект, Объект);
КонецПроцедуры
// Конец СтандартныеПодсистемы.Печать

// СтандартныеПодсистемы.ДополнительныеОтчетыИОбработки
&НаКлиенте
Процедура Подключаемый_ВыполнитьНазначаемуюКоманду(Команда)
	Если НЕ фин_ПроцедурыРаботыСОбъектамиКлиентПереопределяемый.ВыполнитьНазначаемуюКомандуНаКлиенте(ЭтотОбъект, Команда.Имя) Тогда
		РезультатВыполнения = Неопределено;
		ДополнительныеОтчетыИОбработкиВыполнитьНазначаемуюКомандуНаСервере(Команда.Имя, РезультатВыполнения);
		фин_ПроцедурыРаботыСОбъектамиКлиентПереопределяемый.ПоказатьРезультатВыполненияКоманды(ЭтотОбъект, РезультатВыполнения);
	КонецЕсли;
КонецПроцедуры
// Конец СтандартныеПодсистемы.ДополнительныеОтчетыИОбработки


////////////////////////////////////////////////////////////////////////////////
// СЛУЖЕБНЫЕ ПРОЦЕДУРЫ И ФУНКЦИИ

// СтандартныеПодсистемы.ДополнительныеОтчетыИОбработки
&НаСервере
Процедура ДополнительныеОтчетыИОбработкиВыполнитьНазначаемуюКомандуНаСервере(ИмяЭлемента, РезультатВыполнения)
	фин_ПроцедрыРаботыСОбъектамиПереопределяемый.ВыполнитьНазначаемуюКомандуНаСервере(ЭтотОбъект, ИмяЭлемента, РезультатВыполнения);
КонецПроцедуры
// Конец СтандартныеПодсистемы.ДополнительныеОтчетыИОбработки

&НаСервере
Процедура ПодготовитьФормуНаСервере()
	
	ТекущаяДатаДокумента = Объект.Дата;
	
	Если Объект.Ссылка.Пустая() Тогда
		
		Если НЕ (ЗначениеЗаполнено(Параметры.ЗначениеКопирования) ИЛИ ЗначениеЗаполнено(Параметры.Основание)) Тогда
			// по умолчанию при распределении учитываются все возможные показатели
			Если Объект.ДатаНачала='00010101' Тогда
          		Объект.ДатаНачала = НачалоМесяца(ТекущаяДата());
			КонецЕсли;
			Если Объект.ДатаОкончания='00010101' Тогда
          		Объект.ДатаОкончания = КонецМесяца(ТекущаяДата());
			КонецЕсли;

		КонецЕсли;
		
	КонецЕсли;
	
	НадписьРасчетКоэффициентов = "Период расчета коэффициентов";
	
	Если Метаданные.ПодпискиНаСобытия.Найти("фин_ВводРасчетныхДокументовПремирования")<>Неопределено Тогда
		ИсточникПодписки = Метаданные.ПодпискиНаСобытия.Найти("фин_ВводРасчетныхДокументовПремирования").Источник;
		Для Каждого Документ Из Метаданные.Документы Цикл
			Если ИсточникПодписки.СодержитТип(Тип("ДокументОбъект."+Документ.Имя)) И Документ.Имя<>"фин_РасчетПоПлануМотивацииОтветственныхБюджетногоПроцесса" Тогда
				НоваяКоманда = Команды.Добавить(Документ.Имя);
				НоваяКоманда.Заголовок = Документ.Синоним;
				НоваяКоманда.Картинка = БиблиотекаКартинок.ВводНаОсновании;
				НоваяКоманда.Отображение= ОтображениеКнопки.КартинкаИТекст;
				НоваяКоманда.Действие = "ВвестиНаОснованииДокумент";
				КП = Элементы.Добавить(Документ.Имя,Тип("КнопкаФормы"),Элементы.СоздатьНаОсновании);
				КП.Заголовок = Документ.Синоним;
				КП.Картинка = БиблиотекаКартинок.ВводНаОсновании;
				КП.Отображение= ОтображениеКнопки.КартинкаИТекст;
				КП.ИмяКоманды = Документ.Имя;
			КонецЕсли;
		КонецЦикла;
	Иначе
		Элементы.СоздатьНаОсновании.Видимость=Ложь;
	КонецЕсли;

КонецПроцедуры 


//////////////////////////////////////////////////////////////////////////////////////////////////////////////
// ОБРАБОТЧИКИ СОБЫТИЙ РЕКВИЗИТОВ ШАПКИ

&НаКлиенте
Процедура РассчитатьКоэффициенты(Команда)
	Если ПроверитьЗаполнение() Тогда
		ВыполнитьРасчет();
	Иначе
		ПоказатьПредупреждение(,"Для выполнения расчета заполните требуемые поля!");
	КонецЕсли;
КонецПроцедуры

&НаСервере
Процедура ВыполнитьРасчет()
	Документы.фин_РасчетПоПлануМотивацииОтветственныхБюджетногоПроцесса.Рассчитать(Объект);
КонецПроцедуры

&НаКлиенте
Процедура ВвестиНаОснованииДокумент(Команда)
	//Вставить содержимое обработчика.
	ПараметрыФормы = Новый Структура("Основание",Объект.Ссылка);
	ОткрытьФорму("Документ."+Команда.Имя+".ФормаОбъекта", ПараметрыФормы);
КонецПроцедуры

&НаСервере
Функция СоздатьДокумент(ИмяДокумента)
	Документ = Документы[ИмяДокумента].СоздатьДокумент();
	Документ.Заполнить(Объект.Ссылка);
	Возврат Документ;	
КонецФункции


