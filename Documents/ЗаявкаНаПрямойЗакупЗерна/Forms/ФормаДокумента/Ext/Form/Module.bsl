
&НаКлиенте
Процедура ПлощадьПшеницыПриИзменении(Элемент)
	
	ПересчитатьСумму();
	
КонецПроцедуры

&НаКлиенте
Процедура ПлощадьЯчменяПриИзменении(Элемент)
	
	ПересчитатьСумму();
	
КонецПроцедуры

&НаКлиенте
Процедура ОрганизацияПриИзменении(Элемент)	
	Объект.СтруктурноеПодразделение = Неопределено;
КонецПроцедуры

&НаСервере
Процедура ПриСозданииНаСервере(Отказ, СтандартнаяОбработка)
	НеИзменять = Ложь;
	Док = РеквизитФормыВЗначение("Объект");
	
	Элементы.Организация.ТолькоПросмотр = Не УправлениеПользователями.ПолучитьЗначениеПоУмолчанию(ЦС_ОбщегоНазначенияКлиентСерверПовтИсп.ТекущийПользователь(), "УчетПоВсемОрганизациям");
	
	Если ЦС_ОбщегоНазначенияКлиентСерверПовтИсп.ПолучитьПризнакОтображенияСтруктурныхПодразделений() Тогда
		Элементы.СтруктурноеПодразделение.Видимость = Истина;
	КонецЕсли;
	
	//НастройкаПравДоступа.УстановитьДоступностьФормыДляРедактирования(Док, ЭтаФорма);
	
	Если Объект.СтатусЗаявки = ПредопределенноеЗначение("Перечисление.цс_СтатусЗаявкиФорвардныйЗакуп.Одобрена") Тогда
		ТолькоПросмотр = Истина;
	КонецЕсли;
	
КонецПроцедуры

&НаСервере
Процедура ПослеЗаписиНаСервере(ТекущийОбъект, ПараметрыЗаписи)
	
	Запрос = Новый Запрос;
	Запрос.Текст = 
		"ВЫБРАТЬ
		|	цс_ЗаявкаНаФинасирование.Ссылка
		|ИЗ
		|	Документ.цс_ЗаявкаНаФинасирование КАК цс_ЗаявкаНаФинасирование
		|ГДЕ
		|	цс_ЗаявкаНаФинасирование.Дата МЕЖДУ &НачГода И &КонГода
		|	И цс_ЗаявкаНаФинасирование.Поставщик = &Поставщик
		|	И цс_ЗаявкаНаФинасирование.Ссылка <> &Ссылка";

	Запрос.УстановитьПараметр("КонГода", КонецГода(Объект.Дата));
	Запрос.УстановитьПараметр("НачГода", НачалоГода(Объект.Дата));
	Запрос.УстановитьПараметр("Поставщик", Объект.Поставщик);
    Запрос.УстановитьПараметр("Ссылка", Объект.Ссылка);
	
	Результат = Запрос.Выполнить();

	ВыборкаДетальныеЗаписи = Результат.Выбрать();

	Пока ВыборкаДетальныеЗаписи.Следующий() Цикл
		СП = Новый СообщениеПользователю;
		СП.Текст = " "+"
		|В этом году поставщик "+Объект.Поставщик +" делал уже заявку! " + ВыборкаДетальныеЗаписи.Ссылка;
		СП.Сообщить();
	КонецЦикла;

КонецПроцедуры

&НаКлиенте
Процедура СтруктурноеПодразделениеНачалоВыбора(Элемент, ДанныеВыбора, СтандартнаяОбработка)
	СтандартнаяОбработка = Ложь;
	СтруктураПараметров = Новый Структура("Организация, ОргИзменять", Объект.Организация,Элементы.Организация.ТолькоПросмотр);
	ВыбранныйЭлем = ОткрытьФормуМодально("ОбщаяФорма.ЦС_ФормаВыбораСтрукЕдУпр", СтруктураПараметров);

	Если ВыбранныйЭлем <> Неопределено Тогда
		Объект.СтруктурноеПодразделение	= ВыбранныйЭлем.СтруктурноеПодразделение;
		Если Объект.Организация <> ВыбранныйЭлем.организация Тогда
			 Объект.Организация = ВыбранныйЭлем.организация
		КонецЕсли;
		
	КонецЕсли;

КонецПроцедуры

&НаКлиенте
Процедура ПересчитатьСумму()
	
	Объект.ОбщаяПлощадь = Объект.ПлощадьПшеницы+Объект.ПлощадьЯчменя;
	Объект.СуммаДокумента = Объект.Объем*Объект.ЗакупочнаяЦена;
	
КонецПроцедуры

&НаКлиенте
Процедура ЗакупочнаяЦенаПриИзменении(Элемент)
	
	ПересчитатьСумму();	
	
КонецПроцедуры

&НаКлиенте
Процедура ОбъемПриИзменении(Элемент)
	ПересчитатьСумму();
КонецПроцедуры
