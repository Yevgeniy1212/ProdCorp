
&НаСервере
Процедура СоздатьДокументыПереоценкиНаСервере()
	
	НачДата = НачалоДня(Объект.НачалоПериода);
	КонДата = НачалоДня(Объект.КонецПериода);
		
	Пока НачДата<=КонДата Цикл;
		
		//содаем документы по переоценке
		НайденыйДокумент = Документы.ПереоценкаСельскохозяйственнойПродукцииПоСредневзвешеннойЦене.НайтиПоРеквизиту("НачалоПериода", НачДата);
		
		Если НайденыйДокумент = Документы.ПереоценкаСельскохозяйственнойПродукцииПоСредневзвешеннойЦене.ПустаяСсылка() Тогда
			НовыйДок = Документы.ПереоценкаСельскохозяйственнойПродукцииПоСредневзвешеннойЦене.СоздатьДокумент();
		Иначе 
			НовыйДок = НайденыйДокумент.ПолучитьОбъект();
		КонецЕсли;
		
		НовыйДок.Автор = ПараметрыСеанса.ТекущийПользователь;
		НовыйДок.Дата = НачДата;
		НовыйДок.НачалоПериода = НачДата;
		
		ТаблСчетов = Объект.СчетаОтбора.Выгрузить();
		НовыйДок.СчетаОтбора.Загрузить(ТаблСчетов);
		
		НовыйДок.Записать(РежимЗаписиДокумента.Проведение, РежимПроведенияДокумента.Неоперативный);
			
		НовоеСообщение = Новый СообщениеПользователю;
		НовоеСообщение.Текст = "Проведен документ " + НовыйДок;
		НовоеСообщение.Сообщить();
				
		
		//перепроводим документы
		
		СчетаДляОтбора = ТаблСчетов.ВыгрузитьКолонку("СчетУчета");
			Запрос = Новый Запрос;
		Запрос.Текст = 
			"ВЫБРАТЬ
			|	ТиповойОбороты.Регистратор
			|ИЗ
			|	РегистрБухгалтерии.Типовой.Обороты(&ДатаНачала, &ДатаОкончания, Регистратор, Счет В (&Счета), , , , ) КАК ТиповойОбороты
			|ГДЕ
			|	НЕ ТиповойОбороты.Регистратор ССЫЛКА Документ.ПереоценкаСельскохозяйственнойПродукцииПоСредневзвешеннойЦене
			|	И НЕ ТиповойОбороты.Регистратор ССЫЛКА Документ.ур_ПоступлениеЗерна
			|	И НЕ ТиповойОбороты.Регистратор ССЫЛКА Документ.ОперацияБух
			|	И НЕ ТиповойОбороты.Регистратор ССЫЛКА Документ.Сторнирование";
		
		Запрос.УстановитьПараметр("ДатаНачала", НачДата);
		Запрос.УстановитьПараметр("ДатаОкончания", КонецДня(НачДата));
		Запрос.УстановитьПараметр("Счета", СчетаДляОтбора);
		
		РезультатЗапроса = Запрос.Выполнить();
		
		ВыборкаДетальныеЗаписи = РезультатЗапроса.Выбрать();
		
		Пока ВыборкаДетальныеЗаписи.Следующий() Цикл
			
			ДокументДвижения = ВыборкаДетальныеЗаписи.Регистратор.ПолучитьОбъект();
			ДокументДвижения.Записать(РежимЗаписиДокумента.Проведение, РежимПроведенияДокумента.Неоперативный);

			НовоеСообщение = Новый СообщениеПользователю;
			НовоеСообщение.Текст = "Перепроведен документ " + ДокументДвижения;
			НовоеСообщение.Сообщить();

		КонецЦикла;
		
		НачДата = КонецДня(НачДата) + 1;
				
	КонецЦикла;
	
КонецПроцедуры

&НаКлиенте
Процедура СоздатьДокументыПереоценки(Команда)
	СоздатьДокументыПереоценкиНаСервере();
КонецПроцедуры

