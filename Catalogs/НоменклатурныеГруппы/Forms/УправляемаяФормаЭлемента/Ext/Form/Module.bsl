
&НаКлиенте
Процедура УстановитьДоступностьСостава()

	Если Объект.Ссылка.Пустая() Тогда
		СписокГруппы.Отбор.Код.Установить("");

	Иначе
		СписокГруппы.Отбор.Сбросить();
		СписокГруппы.Отбор.НоменклатурнаяГруппа.Установить(Объект.Ссылка);

	КонецЕсли;

КонецПроцедуры

////////////////////////////////////////////////////////////////////////////////
// ОБРАБОТЧИКИ СОБЫТИЙ ФОРМЫ


////////////////////////////////////////////////////////////////////////////////
// ПРОЦЕДУРЫ - ДЕЙСТВИЯ КОМАНДНЫХ ПАНЕЛЕЙ ФОРМЫ

////////////////////////////////////////////////////////////////////////////////
// ОБРАБОТЧИКИ СОБЫТИЙ РАБОТЫ СО СПИСКОМ ГРУППЫ
Функция ЗаписьОбъекта(ОбъектДляЗаписи)
	Возврат ОбъектДляЗаписи.Записать();	
КонецФункции

&НаКлиенте
Процедура СписокГруппыПередНачаломДобавления(Элемент, Отказ, Копирование, Родитель, ЭтоГруппа)
	Перем ВыбЭлемент;
	Отказ = Истина;
	Если Копирование Тогда
		Предупреждение("Ввод новой записи копированием запрещен!");
		Возврат;
	КонецЕсли;
	Если Объект.Ссылка.Пустая() Тогда
		Ответ = Вопрос("Элемент еще не записан. Записать?", РежимДиалогаВопрос.ОКОтмена);
		Если Ответ = КодВозвратаДиалога.ОК Тогда
			Если НЕ ПроверитьЗаполнение() Тогда
				Возврат;
			КонецЕсли;
			//Если Не ЗаписатьВФорме() Тогда
			Если Не ЗаписьОбъекта(Объект) Тогда
				Возврат;
			КонецЕсли;
		Иначе
			Возврат;
		КонецЕсли;
	КонецЕсли;
	Если ВвестиЗначение(ВыбЭлемент,,Тип("СправочникСсылка.Номенклатура")) Тогда
		ОбъектНоменклатуры = ВыбЭлемент.ПолучитьОбъект();
		Если ОбъектНоменклатуры.ЭтоГруппа Тогда
			Предупреждение("В состав номенклатурной группы могут включаться только элементы номенклатуры!");
		Иначе
			Если ЗначениеЗаполнено(ОбъектНоменклатуры.НоменклатурнаяГруппа) Тогда
				Если Вопрос("Выбранная номенклатура " + ВыбЭлемент + " уже входит в группу " + 
					        ОбъектНоменклатуры.НоменклатурнаяГруппа+". Включить ее текущую номенклатурную группу?",
					        РежимДиалогаВопрос.ОКОтмена) = КодВозвратаДиалога.Отмена Тогда
					Возврат;
				КонецЕсли;
			КонецЕсли;
			ОбъектНоменклатуры.НоменклатурнаяГруппа = Объект.Ссылка;
			//ОбъектНоменклатуры.Записать();
			ЗаписьОбъекта(ОбъектНоменклатуры);
			СписокГруппы.Обновить();
		КонецЕсли;
	КонецЕсли;
КонецПроцедуры

&НаКлиенте
Процедура СписокГруппыПриНачалеРедактирования(Элемент, НоваяСтрока)
	Если НоваяСтрока Тогда
		Элемент.ТекущиеДанные.Вес = 1;
		Элемент.ТекущиеДанные.НоменклатурнаяГруппа = Объект.Ссылка;
	КонецЕсли;
КонецПроцедуры


&НаСервере
Процедура ПриСозданииНаСервере(Отказ, СтандартнаяОбработка)
	СписокГруппы.Параметры.УстановитьЗначениеПараметра("НоменклатурнаяГруппаСсылка", объект.Ссылка);
КонецПроцедуры
