#Если Сервер Или ТолстыйКлиентОбычноеПриложение Или ВнешнееСоединение Тогда

Процедура ПередЗаписью(Отказ)
	
	Если ОбменДанными.Загрузка=Истина Тогда
		Возврат;
	КонецЕсли;
	Если ДополнительныеСвойства.Свойство("РежимСозданияЭтапов") Тогда
		Возврат;
	КонецЕсли;
	Запрос = Новый Запрос;
	Запрос.Текст = 
		"ВЫБРАТЬ
		|	Таб.ЭтапОплаты
		|ПОМЕСТИТЬ ТабДок
		|ИЗ
		|	&Таблица КАК Таб
		|;
		|
		|////////////////////////////////////////////////////////////////////////////////
		|ВЫБРАТЬ
		|	КОЛИЧЕСТВО(РАЗЛИЧНЫЕ ТабДок.ЭтапОплаты) КАК ЭтапОплаты
		|ИЗ
		|	ТабДок КАК ТабДок";
    Запрос.УстановитьПараметр("Таблица",ГрафикПлатежей);
	Результат = Запрос.Выполнить();

	ВыборкаДетальныеЗаписи = Результат.Выбрать();
    Колво = 0;
	Пока ВыборкаДетальныеЗаписи.Следующий() Цикл
		КолВо = ВыборкаДетальныеЗаписи.ЭтапОплаты;
	КонецЦикла;
	Если Колво<>ГрафикПлатежей.Количество() Тогда 
		Отказ = Истина;
		ОбщегоНазначенияКлиентСервер.СообщитьПользователю("В графике платежей присутствуют одинаковые этапы оплаты!");
	КонецЕсли;
	
КонецПроцедуры

Процедура ОбработкаПроверкиЗаполнения(Отказ, ПроверяемыеРеквизиты)
	
	МассивНепроверяемыхРеквизитов = Новый Массив();
	
	Если ДополнительныеСвойства.Свойство("РежимСозданияЭтапов") Тогда
		МассивНепроверяемыхРеквизитов.Добавить("ГрафикПлатежей.ЭтапОплаты");
	КонецЕсли;
	
	фин_ЗаполнениеДокументов.УдалитьНепроверяемыеРеквизитыИзМассива(ПроверяемыеРеквизиты, МассивНепроверяемыхРеквизитов);
	
	Для Каждого СтрокаГрафик Из ГрафикПлатежей Цикл
		Если СтрокаГрафик.СпособРасчетаСуммыПлатежа=Перечисления.дог_СпособыРасчетаСуммыПлатежей.НаОснованииСобытия И СтрокаГрафик.ПорядокРасчетаДатыПлатежа<>Перечисления.дог_ПорядкиРасчетаДатыПлатежа.ОтДатыСобытияПоДоговору Тогда
			ОбщегоНазначенияКлиентСервер.СообщитьПользователю("Строка №"+Строка(СтрокаГрафик.НомерСтроки)+":Нельзя установить расчет суммы на основании события при фиксированной дате платежа",ЭтотОбъект,"ГрафикПлатежей["+Строка(ГрафикПлатежей.Индекс(СтрокаГрафик))+"].СпособРасчетаСуммыПлатежа",,Отказ);
		КонецЕсли;
		Если (СтрокаГрафик.СпособРасчетаСуммыПлатежа=Перечисления.дог_СпособыРасчетаСуммыПлатежей.НаОснованииСобытия
			ИЛИ СтрокаГрафик.СпособРасчетаСуммыПлатежа=Перечисления.дог_СпособыРасчетаСуммыПлатежей.ПлановаяСумма
			ИЛИ СтрокаГрафик.СпособРасчетаСуммыПлатежа=Перечисления.дог_СпособыРасчетаСуммыПлатежей.ЗадолженностьНаДатуПлатежа
			ИЛИ СтрокаГрафик.СпособРасчетаСуммыПлатежа=Перечисления.дог_СпособыРасчетаСуммыПлатежей.ПоЗадолженностиНаНачалоПериода
			ИЛИ СтрокаГрафик.СпособРасчетаСуммыПлатежа=Перечисления.дог_СпособыРасчетаСуммыПлатежей.ПоСуммеДоговора) И СтрокаГрафик.ПроцентОтСуммы=0 Тогда
			ОбщегоНазначенияКлиентСервер.СообщитьПользователю("Не указан процент оплаты в строке "+Строка(СтрокаГрафик.НомерСтроки)+" списка ""График платежей""",ЭтотОбъект,"ГрафикПлатежей["+Строка(ГрафикПлатежей.Индекс(СтрокаГрафик))+"].ПроцентОтСуммы",,Отказ);
		КонецЕсли;
		Если СтрокаГрафик.СпособРасчетаСуммыПлатежа=Перечисления.дог_СпособыРасчетаСуммыПлатежей.ФиксированнойСуммой И СтрокаГрафик.Сумма=0 Тогда
			ОбщегоНазначенияКлиентСервер.СообщитьПользователю("Не указана сумма оплаты в строке "+Строка(СтрокаГрафик.НомерСтроки)+" списка ""График платежей""",ЭтотОбъект,"ГрафикПлатежей["+Строка(ГрафикПлатежей.Индекс(СтрокаГрафик))+"].Сумма",,Отказ);
		КонецЕсли;
		Если СтрокаГрафик.СпособРасчетаСуммыПлатежа=Перечисления.дог_СпособыРасчетаСуммыПлатежей.ПлановаяСумма И СтрокаГрафик.Сценарий.Пустая() Тогда
			ОбщегоНазначенияКлиентСервер.СообщитьПользователю("Не указан сценарий расчета оплаты в строке "+Строка(СтрокаГрафик.НомерСтроки)+" списка ""График платежей""",ЭтотОбъект,"ГрафикПлатежей["+Строка(ГрафикПлатежей.Индекс(СтрокаГрафик))+"].Сценарий",,Отказ);
		КонецЕсли;
		Если СтрокаГрафик.СпособРасчетаСуммыПлатежа=Перечисления.дог_СпособыРасчетаСуммыПлатежей.ПлановаяСумма И СтрокаГрафик.ФинансовыйПоказательСценария.Пустая() Тогда
			ОбщегоНазначенияКлиентСервер.СообщитьПользователю("Не указан финансовый показатель расчета оплаты в строке "+Строка(СтрокаГрафик.НомерСтроки)+" списка ""График платежей""",ЭтотОбъект,"ГрафикПлатежей["+Строка(ГрафикПлатежей.Индекс(СтрокаГрафик))+"].ФинансовыйПоказательСценария",,Отказ);
		КонецЕсли;
		Если СтрокаГрафик.СпособРасчетаСуммыПлатежа=Перечисления.дог_СпособыРасчетаСуммыПлатежей.ПлановаяСумма И СтрокаГрафик.ДатаСценария='00010101' Тогда
			ОбщегоНазначенияКлиентСервер.СообщитьПользователю("Не указана период планирования по сценарию для расчета оплаты в строке "+Строка(СтрокаГрафик.НомерСтроки)+" списка ""График платежей""",ЭтотОбъект,"ГрафикПлатежей["+Строка(ГрафикПлатежей.Индекс(СтрокаГрафик))+"].ДатаСценария",,Отказ);
		КонецЕсли;
	КонецЦикла;
	
КонецПроцедуры

#КонецЕсли