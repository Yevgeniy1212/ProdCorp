
Процедура ЗаписьВРегистрСоответствиеНоменклатуры(Объект, ПлановаяНоменклатура, ПлановаяХарактеристика, ДатаСоответствия, Отказ) Экспорт 
	
	Если Отказ Тогда 
		Возврат;
	КонецЕсли;
	
	Если НЕ ЗначениеЗаполнено(ПлановаяНоменклатура) Тогда
		НаборЗаписей = РегистрыСведений.узп_СоответствиеПлановойИРегламентированнойНоменклатуры.СоздатьНаборЗаписей();
		НаборЗаписей.Отбор.РегламентированнаяНоменклатура.Установить(Объект.Ссылка);
		НаборЗаписей.Прочитать();
		Если НаборЗаписей.Количество()=1 Тогда
			НаборЗаписей.Очистить();
			Попытка
				НаборЗаписей.Записать();
			Исключение
				ОбщегоНазначенияКлиентСервер.СообщитьПользователю("При отмене соответствия плановой номенклатуре произошла ошибка: "+ОписаниеОшибки(),,,, Отказ);				
			КонецПопытки;
		КонецЕсли;
	Иначе
		НаборЗаписей = РегистрыСведений.узп_СоответствиеПлановойИРегламентированнойНоменклатуры.СоздатьНаборЗаписей();
		НаборЗаписей.Отбор.РегламентированнаяНоменклатура.Установить(Объект.Ссылка);
		НаборЗаписей.Отбор.Период.Установить(ДатаСоответствия);
		НаборЗаписей.Прочитать();
		НаборЗаписей.Очистить();
		НЗ = НаборЗаписей.Добавить();
		НЗ.Период = ДатаСоответствия;
		НЗ.РегламентированнаяНоменклатура = Объект.Ссылка;
		НЗ.ПлановаяНоменклатура = ПлановаяНоменклатура;
		НЗ.ХарактеристикаПлановойНоменклатуры = ПлановаяХарактеристика;
		Попытка
			НаборЗаписей.Записать(Истина);
		Исключение
			ОбщегоНазначенияКлиентСервер.СообщитьПользователю("При установке соответствия плановой номенклатуре произошла ошибка: "+ОписаниеОшибки(),,,, Отказ);
		КонецПопытки;
	КонецЕсли;
	
КонецПроцедуры
