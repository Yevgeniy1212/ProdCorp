
&НаСервере
Процедура ПриСозданииНаСервере(Отказ, СтандартнаяОбработка)
	Дерево = РеквизитФормыВЗначение("ДеревоТаблиц");
	// справочная информация
	СтрокаСправочная = Дерево.Строки.Добавить();
	СтрокаСправочная.Группа = Истина;
	СтрокаСправочная.Таблица = "Справочная информация";
	Для Каждого Регистр Из Метаданные.РегистрыСведений Цикл
		Если Строка(Регистр.РежимЗаписи) = "Независимый" Тогда
			Если Строка(Регистр.ПериодичностьРегистраСведений)="Непериодический" Тогда
				СтрокаГруппаРегистр = СтрокаСправочная.Строки.Добавить();
				СтрокаГруппаРегистр.Таблица 		= Регистр.Синоним;
				СтрокаГруппаРегистр.Идентификатор 	= "РегистрСведений."+Регистр.Имя;
			Иначе
				СтрокаГруппаРегистр = СтрокаСправочная.Строки.Добавить();
				СтрокаГруппаРегистр.Группа 			= Истина;
				СтрокаГруппаРегистр.Таблица 		= Регистр.Синоним;
				СтрокаГруппаРегистр.Идентификатор 	= "РегистрСведений."+Регистр.Имя;
				СтрокаРегистр = СтрокаГруппаРегистр.Строки.Добавить();
				СтрокаРегистр.Таблица 				= Регистр.Синоним+": история";
				СтрокаРегистр.Идентификатор 		= "РегистрСведений."+Регистр.Имя;
				СтрокаРегистр = СтрокаГруппаРегистр.Строки.Добавить();
				СтрокаРегистр.Таблица 				= Регистр.Синоним+": срез первых";
				СтрокаРегистр.Идентификатор 		= "РегистрСведений."+Регистр.Имя+".СрезПервых";
				СтрокаРегистр = СтрокаГруппаРегистр.Строки.Добавить();
				СтрокаРегистр.Таблица 				= Регистр.Синоним+": срез последних";
				СтрокаРегистр.Идентификатор 		= "РегистрСведений."+Регистр.Имя+".СрезПоследних";
			КонецЕсли;
		КонецЕсли;
	КонецЦикла;
	// оперативные данные
	СтрокаОперативныеДанные = Дерево.Строки.Добавить();
	СтрокаОперативныеДанные.Группа = Истина;
	СтрокаОперативныеДанные.Таблица = "Оперативные данные";
	Для Каждого Регистр Из Метаданные.РегистрыСведений Цикл
		Если Строка(Регистр.РежимЗаписи) <> "Независимый" Тогда
			Если Строка(Регистр.ПериодичностьРегистраСведений)="Непериодический" Тогда
				СтрокаГруппаРегистр = СтрокаОперативныеДанные.Строки.Добавить();
				СтрокаГруппаРегистр.Таблица 		= Регистр.Синоним;
				СтрокаГруппаРегистр.Идентификатор 	= "РегистрСведений."+Регистр.Имя;
			Иначе
				СтрокаГруппаРегистр = СтрокаОперативныеДанные.Строки.Добавить();
				СтрокаГруппаРегистр.Группа 			= Истина;
				СтрокаГруппаРегистр.Таблица 		= Регистр.Синоним;
				СтрокаГруппаРегистр.Идентификатор 	= "РегистрСведений."+Регистр.Имя;
				СтрокаРегистр = СтрокаГруппаРегистр.Строки.Добавить();
				СтрокаРегистр.Таблица 				= Регистр.Синоним+": история";
				СтрокаРегистр.Идентификатор 		= "РегистрСведений."+Регистр.Имя;
				СтрокаРегистр = СтрокаГруппаРегистр.Строки.Добавить();
				СтрокаРегистр.Таблица 				= Регистр.Синоним+": срез первых";
				СтрокаРегистр.Идентификатор 		= "РегистрСведений."+Регистр.Имя+".СрезПервых";
				СтрокаРегистр = СтрокаГруппаРегистр.Строки.Добавить();
				СтрокаРегистр.Таблица 				= Регистр.Синоним+": срез последних";
				СтрокаРегистр.Идентификатор 		= "РегистрСведений."+Регистр.Имя+".СрезПоследних";
			КонецЕсли;
		КонецЕсли;
	КонецЦикла;
	Для Каждого Регистр Из Метаданные.РегистрыНакопления Цикл
		СтрокаГруппаРегистр = СтрокаОперативныеДанные.Строки.Добавить();
		СтрокаГруппаРегистр.Группа 			= Истина;
		СтрокаГруппаРегистр.Таблица 		= Регистр.Синоним;
		СтрокаГруппаРегистр.Идентификатор 	= "РегистрНакопления."+Регистр.Имя;
		СтрокаРегистр = СтрокаГруппаРегистр.Строки.Добавить();
		СтрокаРегистр.Таблица 				= Регистр.Синоним+": движения";
		СтрокаРегистр.Идентификатор 		= "РегистрНакопления."+Регистр.Имя;
		СтрокаРегистр = СтрокаГруппаРегистр.Строки.Добавить();
		СтрокаРегистр.Таблица 				= Регистр.Синоним+": обороты за период";
		СтрокаРегистр.Идентификатор 		= "РегистрНакопления."+Регистр.Имя+".Обороты";
		Если Строка(Регистр.ВидРегистра)="Остатки" Тогда
			СтрокаРегистр = СтрокаГруппаРегистр.Строки.Добавить();
			СтрокаРегистр.Таблица 				= Регистр.Синоним+": остатки";
			СтрокаРегистр.Идентификатор 		= "РегистрНакопления."+Регистр.Имя+".Остатки";
			СтрокаРегистр = СтрокаГруппаРегистр.Строки.Добавить();
			СтрокаРегистр.Таблица 				= Регистр.Синоним+": остатки и обороты за период";
			СтрокаРегистр.Идентификатор 		= "РегистрНакопления."+Регистр.Имя+".ОстаткиИОбороты";
		КонецЕсли;
	КонецЦикла;
	Для Каждого Регистр Из Метаданные.РегистрыРасчета Цикл
		СтрокаГруппаРегистр = СтрокаОперативныеДанные.Строки.Добавить();
		СтрокаГруппаРегистр.Таблица 		= Регистр.Синоним;
		СтрокаГруппаРегистр.Идентификатор 	= "РегистрРасчета."+Регистр.Имя;
	КонецЦикла;
	Для Каждого Регистр Из Метаданные.РегистрыБухгалтерии Цикл
		СтрокаБухгалтерия = Дерево.Строки.Добавить();
		СтрокаБухгалтерия.Группа = Истина;
		СтрокаБухгалтерия.Таблица = "Проводки: "+Регистр.Синоним;
		Регистр = Метаданные.РегистрыБухгалтерии[Регистр.Имя];
		СтрокаГруппаРегистр = СтрокаБухгалтерия.Строки.Добавить();
		СтрокаГруппаРегистр.Группа 			= Истина;
		СтрокаГруппаРегистр.Таблица 		= Регистр.Синоним;
		СтрокаГруппаРегистр.Идентификатор 	= "РегистрБухгалтерии."+Регистр.Имя;
		СтрокаРегистр = СтрокаГруппаРегистр.Строки.Добавить();
		СтрокаРегистр.Таблица 				= Регистр.Синоним+": движения";
		СтрокаРегистр.Идентификатор 		= "РегистрБухгалтерии."+Регистр.Имя;
		СтрокаРегистр = СтрокаГруппаРегистр.Строки.Добавить();
		СтрокаРегистр.Таблица 				= Регистр.Синоним+": обороты за период";
		СтрокаРегистр.Идентификатор 		= "РегистрБухгалтерии."+Регистр.Имя+".Обороты";
		СтрокаРегистр = СтрокаГруппаРегистр.Строки.Добавить();
		СтрокаРегистр.Таблица 				= Регистр.Синоним+": остатки";
		СтрокаРегистр.Идентификатор 		= "РегистрБухгалтерии."+Регистр.Имя+".Остатки";
		СтрокаРегистр = СтрокаГруппаРегистр.Строки.Добавить();
		СтрокаРегистр.Таблица 				= Регистр.Синоним+": остатки и обороты за период";
		СтрокаРегистр.Идентификатор 		= "РегистрБухгалтерии."+Регистр.Имя+".ОстаткиИОбороты";
		СтрокаРегистр = СтрокаГруппаРегистр.Строки.Добавить();
		СтрокаРегистр.Таблица 				= Регистр.Синоним+": движения с субконто";
		СтрокаРегистр.Идентификатор 		= "РегистрБухгалтерии."+Регистр.Имя+".ДвиженияССубконто";
		СтрокаРегистр = СтрокаГруппаРегистр.Строки.Добавить();
		СтрокаРегистр.Таблица 				= Регистр.Синоним+": обороты Дт/Кт";
		СтрокаРегистр.Идентификатор 		= "РегистрБухгалтерии."+Регистр.Имя+".ОборотыДтКт";
	КонецЦикла;
	Дерево.Строки.Сортировать("Таблица",Истина);
	ЗначениеВРеквизитФормы(Дерево,"ДеревоТаблиц");
КонецПроцедуры

&НаКлиенте
Процедура ДеревоТаблицВыбор(Элемент, ВыбраннаяСтрока, Поле, СтандартнаяОбработка)
	Если Элементы.ДеревоТаблиц.ТекущиеДанные.Группа Тогда
		Возврат;
	КонецЕсли;
	Закрыть(Новый Структура("Имя,Представление",Элементы.ДеревоТаблиц.ТекущиеДанные.Идентификатор,Элементы.ДеревоТаблиц.ТекущиеДанные.Таблица));
КонецПроцедуры
