
&НаСервере
Процедура ПриСозданииНаСервере(Отказ, СтандартнаяОбработка)
	Если Параметры.Свойство("ВидОтбора") Тогда
		Отбор = Список.Отбор.Элементы.Добавить(Тип("ЭлементОтбораКомпоновкиДанных"));
		Отбор.ЛевоеЗначение = Новый ПолеКомпоновкиДанных("Ссылка");
		Отбор.ВидСравнения = ВидСравненияКомпоновкиДанных[Параметры.ВидОтбора];
		Отбор.ПравоеЗначение= Параметры.ЗначениеОтбора;
		Отбор.Использование = Истина;
	КонецЕсли;
	Если фин_ОбщегоНазначенияВызовСервераПовтИсп.ЗначениеПеременной("фин_ИспользоватьОграниченияПоБюджетам") Тогда
			Запрос = Новый Запрос;
			Запрос.Текст = 
				"ВЫБРАТЬ
				|	общ_ОбъектыДоступаПоПрофилям.ОбъектДоступа
				|ИЗ
				|	РегистрСведений.общ_СоставПрофилейДоступа КАК общ_СоставПрофилейДоступа
				|		ЛЕВОЕ СОЕДИНЕНИЕ РегистрСведений.общ_ОбъектыДоступаПоПрофилям КАК общ_ОбъектыДоступаПоПрофилям
				|		ПО общ_СоставПрофилейДоступа.Профиль = общ_ОбъектыДоступаПоПрофилям.Профиль
				|			И (общ_ОбъектыДоступаПоПрофилям.ОбъектДоступа ССЫЛКА Справочник.фин_Бюджеты)
				|ГДЕ
				|	общ_СоставПрофилейДоступа.Пользователь = &Пользователь
				|	И НЕ общ_СоставПрофилейДоступа.Профиль.ПометкаУдаления
				|	И общ_СоставПрофилейДоступа.Профиль.ВидПрофиляДоступа = &ВидПрофиляДоступа
				|	И общ_СоставПрофилейДоступа.Профиль.ВариантОграничения В(&ВариантОграничения)";
			ВариантОграничения = Новый СписокЗначений;
			ВариантОграничения.Добавить(Перечисления.фин_ВариантыОграниченияДоступаКДаннымБюджетов.ПоВидамБюджетов);
			ВариантОграничения.Добавить(Перечисления.фин_ВариантыОграниченияДоступаКДаннымБюджетов.ПоВидамБюджетовИПоПодразделениям);
			Запрос.УстановитьПараметр("ВариантОграничения", ВариантОграничения);
			Запрос.УстановитьПараметр("ВидПрофиляДоступа", Перечисления.общ_ВидыПрофилейДоступа.Бюджеты);
			Запрос.УстановитьПараметр("Пользователь", фин_ОбщегоНазначенияВызовСервераПовтИсп.ЗначениеПеременной("ТекущийПользователь"));

		Результат = Запрос.Выполнить();
		СписокДоступных = Результат.Выгрузить().ВыгрузитьКолонку("ОбъектДоступа");
		Отбор = Список.Отбор.Элементы.Добавить(Тип("ЭлементОтбораКомпоновкиДанных"));
		Отбор.ЛевоеЗначение = Новый ПолеКомпоновкиДанных("Ссылка");
		Отбор.ВидСравнения = ВидСравненияКомпоновкиДанных.ВСписке;
		Отбор.ПравоеЗначение= СписокДоступных;
		Отбор.Использование = Истина;

	КонецЕсли;
	Список.Параметры.УстановитьЗначениеПараметра("ПериодПланирования",Параметры.ПериодПланирования);
	Список.Параметры.УстановитьЗначениеПараметра("Сценарий",Параметры.Сценарий);
	Список.Параметры.УстановитьЗначениеПараметра("ЖесткийКонтрольРегламента",НЕ фин_ОбщегоНазначенияВызовСервераПовтИсп.ЗначениеПеременной("фин_РазрешитьФормированиеБюджетовВнеПорядкаРегламента"));
КонецПроцедуры
