////////////////////////////////////////////////////////////////////////////////
// ПЕРЕМЕННЕ МОДУЛЯ
&НаКлиенте
Перем мЖирныйШрифт;
&НаКлиенте
Перем мОбычныйШрифт;

////////////////////////////////////////////////////////////////////////////////
// ОБРАБОТЧИКИ СОБЫТИЙ ФОРМЫ

// Обработчик события ПриОткрытии формы.
//
&НаКлиенте
Процедура ПриОткрытии(Отказ)
	ОсновнаяОрганизация = УправлениеПользователями.ПолучитьЗначениеПоУмолчанию(глТекущийПользователь, "ОсновнаяОрганизация");
	Список.Параметры.УстановитьЗначениеПараметра("Основной", ОсновнаяОрганизация);
КонецПроцедуры // ПриОткрытии()

////////////////////////////////////////////////////////////////////////////////
// ОБРАБОТЧИКИ СОБЫТИЙ ЭЛЕМЕНТОВ ФОРМЫ
&наКлиенте
Процедура СписокПриАктивизацииСтроки(Элемент)
	Если Элементы.СправочникСписок.ТекущиеДанные = Неопределено Тогда
		Элементы.СписокУстановитьОсновной.Доступность = Ложь;
	Иначе
		Элементы.СписокУстановитьОсновной.Доступность = Истина;
	КонецЕсли;
КонецПроцедуры // СправочникСписокПриАктивизацииСтроки()

&НаКлиенте
Процедура УстановитьОсновной(Команда)
	Результат = УстановитьОсновнойНаСервере(глТекущийПользователь,Элементы.Список.ТекущиеДанные.Ссылка);
	Если Результат=ПредопределенноеЗначение("Справочник.Организации.ПустаяСсылка") тогда
		Предупреждение("Не выбрана организация!!!", , ); 
	КонецЕсли;
	Список.Параметры.УстановитьЗначениеПараметра("Основной", Результат);
КонецПроцедуры

&НаСервере
Функция УстановитьОсновнойНаСервере(глТекущийПользователь,Ссылка)
	Попытка
		Набор = РегистрыСведений.НастройкиПользователей.СоздатьНаборЗаписей();
		Набор.Отбор.Пользователь.Использование = Истина;
		Набор.Отбор.Пользователь.Значение      = глТекущийПользователь;
		Набор.Отбор.Настройка.Использование    = Истина;
		Набор.Отбор.Настройка.Значение         = ПланыВидовХарактеристик.НастройкиПользователей.ОсновнаяОрганизация;
		Запись = Набор.Добавить();
		Запись.Пользователь = глТекущийПользователь;
		Запись.Настройка    = ПланыВидовХарактеристик.НастройкиПользователей.ОсновнаяОрганизация;
		Запись.Значение     = Ссылка;
		Набор.Записать();
		Возврат Ссылка;
	Исключение
		Возврат ПредопределенноеЗначение("Справочник.Организации.ПустаяСсылка");
	КонецПопытки;
КонецФункции // ДействияФормыУстановитьОсновной()

////////////////////////////////////////////////////////////////////////////////
// ОПЕРАТОРЫ ОСНОВНОЙ ПРОГРАММЫ

