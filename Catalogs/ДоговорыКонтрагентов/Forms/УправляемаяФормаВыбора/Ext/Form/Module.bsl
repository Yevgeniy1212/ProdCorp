
&НаКлиенте
Процедура СписокПриАктивизацииСтроки(Элемент)
	Если НЕ  Элементы.Список.ТекущиеДанные = Неопределено  Тогда
		//Элементы.СправочникДерево.ТекущаяСтрока = ЭлементыФормы.СправочникСписок.ТекущийРодитель;
		//ЭтаФорма.Заголовок = "Договоры контрагентов: " + ?(ЭлементыФормы.СправочникСписок.ТекущаяСтрока.Владелец.Пустая(), "Владелец не задан",ЭлементыФормы.СправочникСписок.ТекущаяСтрока.Владелец.Наименование) ; 
		ЭтаФорма.Заголовок = ?(Элементы.Список.ТекущиеДанные.Владелец.Пустая(), "Владелец не задан",Элементы.Список.ТекущиеДанные.Владелец) ;
	КонецЕсли;

КонецПроцедуры

&НаСервере
Процедура СписокПередНачаломДобавления(Элемент, Отказ, Копирование, Родитель, Группа)
	МассивПолейОтбора = Новый Массив;
	МассивПолейОтбора.Добавить("Организация");
	МассивПолейОтбора.Добавить("ВидДоговора");
	МассивПолейОтбора.Добавить("ВедениеВзаиморасчетов");
	МассивПолейОтбора.Добавить("ВалютаВзаиморасчетов");

	Если НЕ Копирование и Не Группа Тогда

		Для Каждого ИмяПоляОтбора Из МассивПолейОтбора Цикл
			ОтборФормы = Список.Отбор[ИмяПоляОтбора];
			Если ОтборФормы.Использование
			   И (ОтборФормы.ВидСравнения = ВидСравнения.Равно Или ОтборФормы.ВидСравнения = ВидСравнения.ВСписке) Тогда
				Отказ = Истина;
				Прервать;
			КонецЕсли;
		КонецЦикла;

		Если Отказ = Истина Тогда

			НовыйОбъект = Справочники.ДоговорыКонтрагентов.СоздатьЭлемент();

			Для Каждого ИмяПоляОтбора Из МассивПолейОтбора Цикл
				ОтборФормы = Список.Отбор[ИмяПоляОтбора];
				Если ОтборФормы.Использование Тогда
					Если ОтборФормы.ВидСравнения = ВидСравнения.Равно Тогда
						НовыйОбъект[ИмяПоляОтбора] = ОтборФормы.Значение;
					ИначеЕсли ОтборФормы.ВидСравнения = ВидСравнения.ВСписке Тогда
						Если ТипЗнч(ОтборФормы.Значение) = Тип("СписокЗначений") и ОтборФормы.Значение.Количество() > 0 Тогда
							НовыйОбъект[ИмяПоляОтбора] = ОтборФормы.Значение[0];
						КонецЕсли;
					КонецЕсли;
				КонецЕсли
			КОнецЦикла;

			// Надо установить владельца, если он задан
			Если Список.Отбор.Владелец.Использование
			   И Список.Отбор.Владелец.ВидСравнения = ВидСравнения.Равно Тогда
				НовыйОбъект.Владелец = Список.Отбор.Владелец.Значение;
			КонецЕсли;

			НовыйОбъект.ПолучитьФорму(,Элементы.Список).Открыть();

		КонецЕсли;

	КонецЕсли;

КонецПроцедуры


&НаКлиенте
Процедура ПриОткрытии(Отказ)
	ВладелецВОтборе = куфиб_ОбщегоНазначения.НайтиЭлементОтбораВКомпоновке(Список.Отбор,"Владелец",Ложь);
	Если ВладелецВОтборе<>Неопределено тогда
		Если НЕ ЗначениеЗаполнено(ВладелецВОтборе.ПравоеЗначение) Тогда
			//ФормаВыбораВладельца = Справочники.Контрагенты.ПолучитьФормуВыбора();
			ЗаголовокФормыВыбора = "Выберите контрагента, договор которого Вы хотите выбрать.";
			ПараметрыФормы= Новый Структура;
			ПараметрыФормы.Вставить("Заголовок", ЗаголовокФормыВыбора);
			Контрагент = ОткрытьФормуМодально("Справочник.Контрагенты.ФормаВыбора",ПараметрыФормы,ЭтаФорма);
			ВладелецВОтборе.ПравоеЗначение = Контрагент;
			ВладелецВОтборе.Использование = ЗначениеЗаполнено(ВладелецВОтборе.ПравоеЗначение);
		КонецЕсли;
	КонецЕсли;

КонецПроцедуры

