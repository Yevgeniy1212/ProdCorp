////////////////////////////////////////////////////////////////////////////////
// ОБРАБОТЧИКИ СОБЫТИЙ ЭЛЕМЕНТОВ ФОРМЫ

// Процедура вызывается перед началом изменения строки списка справочника
//
&НаКлиенте
Процедура СписокПередНачаломИзменения(Элемент, Отказ)
	Если Элемент.ТекущиеДанные <> Неопределено Тогда
		Отказ = Элемент.ТекущиеДанные.Предопределенный
	КонецЕсли;
КонецПроцедуры

// Процедура вызывается при начале редактирования строки списка справочника
//
&НаКлиенте
Процедура СписокПриНачалеРедактирования(Элемент, НоваяСтрока, Копирование)

	Если НоваяСтрока Тогда

		Если Список.Отбор.ВидОбъектаКонтактнойИнформации.Использование = Истина
		   И Список.Отбор.ВидОбъектаКонтактнойИнформации.Значение <> Неопределено Тогда
			Элемент.ТекущиеДанные.ВидОбъектаКонтактнойИнформации = Список.Отбор.ВидОбъектаКонтактнойИнформации.Значение;
		КонецЕсли;

		Если Список.Отбор.Тип.Использование = Истина
		   И Список.Отбор.Тип.Значение <> Неопределено Тогда
			Если ТипЗнч(Список.Отбор.Тип.Значение) = Тип("СписокЗначений") И Список.Отбор.Тип.Значение.Количество()>0 Тогда
				ВыбранныйЭлементСписка = Список.Отбор.Тип.Значение.ВыбратьЭлемент();
				Если ВыбранныйЭлементСписка = Неопределено Тогда
					Элемент.ТекущиеДанные.Тип = Список.Отбор.Тип.Значение[0];
				Иначе
					Элемент.ТекущиеДанные.Тип = ВыбранныйЭлементСписка.Значение;
				КонецЕсли; 
			Иначе
				Элемент.ТекущиеДанные.Тип = Список.Отбор.Тип.Значение;
			КонецЕсли; 
		КонецЕсли;
	КонецЕсли;
КонецПроцедуры

// Процедура вызывается перед окончанием редактирования строки
//
&НаКлиенте
Процедура СписокПередОкончаниемРедактирования(Элемент, НоваяСтрока, ОтменаРедактирования, Отказ)

	Если Элемент.ТекущиеДанные.ВидОбъектаКонтактнойИнформации.Пустая() И НЕ ОтменаРедактирования Тогда
		Предупреждение("Укажите вид объекта контактной информации.");
		Элементы.Список.Колонки.ВидОбъектаКонтактнойИнформации.Видимость = Истина;
		Отказ = Истина;
		Возврат;
	КонецЕсли;

КонецПроцедуры


&НаКлиенте
Процедура СписокПередНачаломДобавления(Элемент, Отказ, Копирование, Родитель, Группа)
	Отказ = Истина;
	ОтборТип = куфиб_ОбщегоНазначения.НайтиЭлементОтбораВКомпоновке(Список.Отбор, "Тип", Истина);
	ОтборВид = куфиб_ОбщегоНазначения.НайтиЭлементОтбораВКомпоновке(Список.Отбор, "ВидОбъектаКонтактнойИнформации", Истина);
	
	ПараметрыФормы = Новый Структура;
	ПараметрыФормы.Вставить("Вид",ОтборВид.ПравоеЗначение);
	ПараметрыФормы.Вставить("Тип",ОтборТип.ПравоеЗначение);
	ОткрытьФорму("Справочник.ВидыКонтактнойИнформации.ФормаОбъекта",ПараметрыФормы,Элемент);
КонецПроцедуры

