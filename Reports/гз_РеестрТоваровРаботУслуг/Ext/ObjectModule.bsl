
////////////////////////////////////////////////////////////////////////////////
// ПЕРЕМЕННЫЕ МОДУЛЯ

// Хранит список структурных единиц, по которым строится отчет
Перем мСписокСтруктурныхЕдиниц Экспорт; // (отчет)

////////////////////////////////////////////////////////////////////////////////
// ЭКСПОРТНЫЕ ПРОЦЕДУРЫ И ФУНКЦИИ 

// Функция формирует запрос
// 
Функция СформироватьЗапрос(Период)Экспорт
	
	Запрос = Новый Запрос;
	Запрос.Текст = 
	"ВЫБРАТЬ
	|	гз_ГосПлан.Номенклатура,
	|	ЕСТЬNULL(гз_СвойстваНоменклатуры.Работа, ЛОЖЬ) КАК Работа
	|ИЗ
	|	РегистрНакопления.гз_ГодовойПланЗакупок КАК гз_ГосПлан
	|		ЛЕВОЕ СОЕДИНЕНИЕ РегистрСведений.гз_СвойстваНоменклатуры КАК гз_СвойстваНоменклатуры
	|		ПО гз_ГосПлан.Номенклатура = гз_СвойстваНоменклатуры.Номенклатура
	|ГДЕ
	|	гз_ГосПлан.Организация В (&Организация)
	|	И гз_ГосПлан.Год МЕЖДУ &НачалоГода И &КонецГода
	|	И гз_ГосПлан.Количество <> 0
	|
	|СГРУППИРОВАТЬ ПО
	|	гз_ГосПлан.Номенклатура,
	|	ЕСТЬNULL(гз_СвойстваНоменклатуры.Работа, ЛОЖЬ)
	|АВТОУПОРЯДОЧИВАНИЕ";
	Запрос.УстановитьПараметр("Организация", мСписокСтруктурныхЕдиниц.ВыгрузитьЗначения());
	Запрос.УстановитьПараметр("ВидДвижения", ВидДвиженияНакопления.Приход);
	Запрос.УстановитьПараметр("НачалоГода", НачалоГода(Период));
	Запрос.УстановитьПараметр("КонецГода", КонецГода(Период));
	Возврат Запрос.Выполнить();
	
КонецФункции // ЗаполнитьСведенияОбОрганизации

////////////////////////////////////////////////////////////////////////////////
// ОПЕРАТОРЫ ОСНОВНОЙ ПРОГРАММЫ 

мСписокСтруктурныхЕдиниц = Новый СписокЗначений;

