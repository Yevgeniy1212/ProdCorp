////////////////////////////////////////////////////////////////////////////////
// ВСПОМОГАТЕЛЬНЫЕ ПРОЦЕДУРЫ И ФУНКЦИИ

#Если Клиент Тогда

Функция СформироватьЗапрос()
	
	мВидыСубконто = Новый Массив;
	//мВидыСубконто.Добавить(ПланыВидовХарактеристик.ВидыСубконтоТиповые.Контрагенты);
	мВидыСубконто.Добавить(ПланыВидовХарактеристик.ВидыСубконтоТиповые.Договоры);
	
	мСписокСчетов = Новый Массив;
	мСписокСчетов.Добавить(ПланыСчетов.Типовой.КраткосрочнаяЗадолженностьПоставщикамИПодрядчикам);
	
	Запрос = Новый Запрос;
	
	Запрос.УстановитьПараметр("НачПериода", НачалоДня(НачалоГода(Год)));
	Запрос.УстановитьПараметр("КонПериода", КонецДня(КонецГода(Год)));
	Запрос.УстановитьПараметр("мВидыСубконто", мВидыСубконто);
	Запрос.УстановитьПараметр("мСписокСчетов", мСписокСчетов);
	Запрос.УстановитьПараметр("выбГод", Год);
	Запрос.УстановитьПараметр("СтатусДоговора", Перечисления.гз_СтатусыДоговоров.Статус_1);
	Запрос.УстановитьПараметр("Состояние", Перечисления.гз_СостоянияДоговоровПоГосударственнымЗакупкам.Зарегистрирован);
	
	ТекстУсловия = "";
	ТекстДопУсловия = "";
	Союз = " И ";
	
	Если ОтборОрганизации Тогда
		
		Запрос.УстановитьПараметр("Организация", Организация);
		
		Если ВидСравненияОрганизации = ВидСравнения.Равно Тогда
			ВидСравненияОрганизацииСтрокой = " = &Организация" 
		ИначеЕсли ВидСравненияОрганизации = ВидСравнения.НеРавно Тогда
			ВидСравненияОрганизацииСтрокой = " <> &Организация"
		ИначеЕсли ВидСравненияОрганизации = ВидСравнения.ВСписке Тогда
			ВидСравненияОрганизацииСтрокой = " В (&Организация)"
		Иначе
			ВидСравненияОрганизацииСтрокой = " НЕ В (&Организация)"
		КонецЕсли; 
		
		ТекстУсловия = ТекстУсловия + Союз + "Организация " + ВидСравненияОрганизацииСтрокой;
		ТекстДопУсловия = "Организация " + ВидСравненияОрганизацииСтрокой;
		Союз         = " И ";
		
	КонецЕсли;
	
	Запрос.Текст =
	"ВЫБРАТЬ РАЗЛИЧНЫЕ
	|	гз_СтатусыДоговоровПоГосударственнымЗакупкамСрезПоследних.ДоговорКонтрагента
	|ПОМЕСТИТЬ СписокДляОтбора
	|ИЗ
	|	РегистрСведений.гз_СтатусыДоговоровПоГосударственнымЗакупкам.СрезПоследних(&КонПериода, Статус = &СтатусДоговора) КАК гз_СтатусыДоговоровПоГосударственнымЗакупкамСрезПоследних
	|;
	|ВЫБРАТЬ
	|	ЗарегистрированныеДоговора.Регистратор КАК Регистратор,
	|	гз_ДвижениеНоменклатурыПоДоговорамОбороты.ДоговорКонтрагента,
	|	гз_ДвижениеНоменклатурыПоДоговорамОбороты.Номенклатура,
	|	гз_ДвижениеНоменклатурыПоДоговорамОбороты.КоличествоОборот КАК Количество,
	|	гз_ДвижениеНоменклатурыПоДоговорамОбороты.СуммаОборот КАК Сумма
	|ИЗ
	|	РегистрНакопления.гз_ДвижениеНоменклатурыПоДоговорам.Обороты(
	|			&НачПериода,
	|			&КонПериода,
	|			,
	|			ДоговорКонтрагента В
	|				(ВЫБРАТЬ
	|					СписокДляОтбора.ДоговорКонтрагента
	|				ИЗ
	|					СписокДляОтбора КАК СписокДляОтбора)) КАК гз_ДвижениеНоменклатурыПоДоговорамОбороты	
	|
	| ЛЕВОЕ СОЕДИНЕНИЕ
	|			(ВЫБРАТЬ
	|              гз_ДоговорыКонтрагентовПоГосударственнымЗакупкам.Регистратор КАК Регистратор,
	|              гз_ДоговорыКонтрагентовПоГосударственнымЗакупкам.ДоговорКонтрагента КАК ДоговорКонтрагента
	|			ИЗ
	|				РегистрСведений.гз_ДоговорыКонтрагентовПоГосударственнымЗакупкам КАК гз_ДоговорыКонтрагентовПоГосударственнымЗакупкам
	|			ГДЕ
	|               гз_ДоговорыКонтрагентовПоГосударственнымЗакупкам.Состояние = &Состояние
	|				И гз_ДоговорыКонтрагентовПоГосударственнымЗакупкам.Год = &выбГод"+ТекстУсловия+"
	|           ) КАК ЗарегистрированныеДоговора
	|        ПО ЗарегистрированныеДоговора.ДоговорКонтрагента = гз_ДвижениеНоменклатурыПоДоговорамОбороты.ДоговорКонтрагента
	|
	|
	|
	|ИТОГИ Сумма(Количество),
	|		Сумма(Сумма)
	|	ПО ОБЩИЕ";
	
	Возврат Запрос.Выполнить();
	
КонецФункции // СформироватьЗапрос()


////////////////////////////////////////////////////////////////////////////////
// ЭКСПОРТНЫЕ ПРОЦЕДУРЫ И ФУНКЦИИ 

Процедура СформироватьОтчет(ДокументРезультат) Экспорт	
	
	ДокументРезультат.Очистить();
	
	Макет 		 = ПолучитьМакет("Макет");
	ОбластьЗаголовок = Макет.ПолучитьОбласть("Заголовок");
	ОбластьШапка = Макет.ПолучитьОбласть("Шапка");
	
	СтрокаОтбора = "Отбор:";
	
	// Информация об отборе.
	Если ОтборОрганизации Тогда
		
		СписокОтборПоОрганизации = "";
		
		Если ТипЗнч(Организация) = Тип("СправочникСсылка.Организации") Тогда
			Если Организация = Справочники.Организации.ПустаяСсылка() Тогда
			Иначе
				СписокОтборПоОрганизации = Организация
			КонецЕсли;
		Иначе
			Если Организация.Количество() = 0 Тогда
			Иначе	
				СписокОтборПоОрганизации =  Организация
			КонецЕсли; 
		КонецЕсли;
		//СтрокаОтбора = СтрокаОтбора + Символы.ПС + СписокОтбор;
		
	КонецЕсли;
	
	
	ОбластьЗаголовок.Параметры.СписокОтборПоОрганизации = СписокОтборПоОрганизации;
	//ОбластьШапка.Параметры.Отбор = СтрокаОтбора;
	
	ТекстПериода = Отчеты_БК.СформироватьСтрокуВыводаПараметровПоДатам(НачалоГода(Год), КонецГода(Год));
	ОбластьЗаголовок.Параметры.ПредставлениеЗаголовка = "Исполнение договоров за "+ТекстПериода;
	
	ДокументРезультат.Вывести(ОбластьЗаголовок);
	ДокументРезультат.Вывести(ОбластьШапка);
	
	
	ОбластьСтрока = Макет.ПолучитьОбласть("Строка");
	ОбластьИТОГО = Макет.ПолучитьОбласть("ИТОГО");
	
	РЕзультат = СформироватьЗапрос();
	
	выборкаОбщие = РЕзультат.Выбрать(ОбходРезультатаЗапроса.ПоГруппировкам,"Общие");
    выборкаОбщие.Следующий();
	
	ВыборкаПоДеталям = выборкаОбщие.Выбрать(ОбходРезультатаЗапроса.ПоГруппировкам);
	
	НомПП=0;
	
	Пока  ВыборкаПоДеталям.Следующий() Цикл
		
		ДокументРегистрации = ВыборкаПоДеталям.Регистратор;
		 
		ОбластьСтрока.Параметры.Заполнить(ВыборкаПоДеталям);
		
		Если ДокументРегистрации <> НЕОПРЕДЕЛЕНО Тогда
			ОбластьСтрока.Параметры.НомерДоговора = ДокументРегистрации.НомерДоговора;
			ОбластьСтрока.Параметры.ДатаДоговора = ДокументРегистрации.ДатаДоговора;
		КонецЕсли;
		
		ОбластьСтрока.Параметры.БИНЗаказчика = ВыборкаПоДеталям.ДоговорКонтрагента.Владелец.ИдентификационныйКодЛичности;
		ОбластьСтрока.Параметры.РННЗаказчика = ВыборкаПоДеталям.ДоговорКонтрагента.Владелец.РНН;
		ОбластьСтрока.Параметры.НаименованиеКЗ = ВыборкаПоДеталям.Номенклатура.НаименованиеПолноеКЗ;
		ОбластьСтрока.Параметры.Наименование = ВыборкаПоДеталям.Номенклатура.НаименованиеПолное;
		ОбластьСтрока.Параметры.КодКПВЭД = ВыборкаПоДеталям.Номенклатура.КодКПВЭД;
		ОбластьСтрока.Параметры.КодЕдИзм = ВыборкаПоДеталям.Номенклатура.БазоваяЕдиницаИзмерения.Код;
		
		ДокументРезультат.Вывести(ОбластьСтрока);
	КонецЦикла;           	
	
		ОбластьИТОГО.Параметры.Заполнить(выборкаОбщие);
		ОбластьИТОГО.Параметры.ПредставлениеИтого = "Всего по области";
		ДокументРезультат.Вывести(ОбластьИТОГО);
	
КонецПроцедуры // СформироватьОтчет()

#КонецЕсли
