
&НаСервере
Процедура ПриСозданииНаСервере(Отказ, СтандартнаяОбработка)
	Если Параметры.Свойство("Период") Тогда	РегистрСведенийМенеджерЗаписи.Период = Параметры.Период; КонецЕсли;
	Если Параметры.Свойство("ДатаВыдачи") Тогда	РегистрСведенийМенеджерЗаписи.ДатаВыдачи = Параметры.ДатаВыдачи; КонецЕсли;
	Если Параметры.Свойство("Статус") Тогда	РегистрСведенийМенеджерЗаписи.Статус = Параметры.Статус; КонецЕсли;
	Если Параметры.Свойство("НомерУдостоверения") Тогда	РегистрСведенийМенеджерЗаписи.НомерУдостоверения = Параметры.НомерУдостоверения; КонецЕсли;
	Если Параметры.Свойство("СерияУдостоверения") Тогда	РегистрСведенийМенеджерЗаписи.СерияУдостоверения = Параметры.СерияУдостоверения; КонецЕсли;
	Если Параметры.Свойство("ФизЛицо") Тогда	РегистрСведенийМенеджерЗаписи.ФизЛицо = Параметры.ФизЛицо; КонецЕсли;
КонецПроцедуры

////////////////////////////////////////////////////////////////////////////////
// ОБРАБОТЧИКИ СОБЫТИЙ ФОРМЫ
&НаКлиенте
Процедура ПриОткрытии(Отказ)
	ФизЛицоПриОткрытии            = РегистрСведенийМенеджерЗаписи.ФизЛицо;
	ПериодПриОткрытии             = РегистрСведенийМенеджерЗаписи.Период;
	ДатаВыдачиПриОткрытии 		  = РегистрСведенийМенеджерЗаписи.ДатаВыдачи;
	СтатусПриОткрытии		  	  = РегистрСведенийМенеджерЗаписи.Статус;
	НомерУдостоверенияПриОткрытии = РегистрСведенийМенеджерЗаписи.НомерУдостоверения;
	СерияУдостоверенияПриОткрытии = РегистрСведенийМенеджерЗаписи.СерияУдостоверения;
	Заголовок = Заголовок + " " + РегистрСведенийМенеджерЗаписи.ФизЛицо;
	ЭтаФорма.Прочитать();
	// У записи обязательно должны быть заполнены реквизиты ФизЛицо и Период
	Если РегистрСведенийМенеджерЗаписи.ФизЛицо.Пустая() Тогда
	    РегистрСведенийМенеджерЗаписи.ФизЛицо = ФизЛицоПриОткрытии;
		РегистрСведенийМенеджерЗаписи.Период  = ПериодПриОткрытии;
	КонецЕсли;
	
КонецПроцедуры

&НаКлиенте
Процедура ПередЗаписью(Отказ, ПараметрыЗаписи)
	// жестко установим физлицо
	РегистрСведенийМенеджерЗаписи.ФизЛицо = ФизЛицоПриОткрытии;
КонецПроцедуры

&НаКлиенте
Процедура ПослеЗаписи(ПараметрыЗаписи)
	Оповестить("ОбновитьФорму", Новый Структура("ИмяЭлемента","СтатусУчастникаВОВ"), РегистрСведенийМенеджерЗаписи.ФизЛицо);
КонецПроцедуры

&НаКлиенте
Процедура ПриЗакрытии()
	Оповестить("ОбновитьФорму", Новый Структура("ИмяЭлемента","СтатусУчастникаВОВ"), РегистрСведенийМенеджерЗаписи.ФизЛицо);
КонецПроцедуры

////////////////////////////////////////////////////////////////////////////////
// ОБРАБОТЧИКИ СОБЫТИЙ ЭЛЕМЕНТОВ ФОРМЫ
&НаКлиенте
Процедура КнопкаИсторияНажатие(Элемент)
	ПараметрыФормы = Новый Структура;
	ПараметрыФормы.Вставить("ЗначениеОтбора", РегистрСведенийМенеджерЗаписи.ФизЛицо);
	ОткрытьФорму("РегистрСведений.СведенияОФизлицахУчастникахВОВ.ФормаСписка",ПараметрыФормы,Элемент);
	
	//ФормаРегистра = РегистрыСведений.СведенияОФизлицахУчастникахВОВ.ПолучитьФормуСписка();
	//ФормаРегистра.РегистрСведенийСписок.Отбор.ФизЛицо.Значение = ФизЛицо;
	//ФормаРегистра.РегистрСведенийСписок.Отбор.ФизЛицо.ВидСравнения = ВидСравнения.Равно;
	//ФормаРегистра.РегистрСведенийСписок.Отбор.ФизЛицо.Использование = Истина;
	//ФормаРегистра.ЭлементыФормы.РегистрСведенийСписок.НачальноеОтображениеСписка = НачальноеОтображениеСписка.Конец;
	//
	//ФормаРегистра.Открыть();
	
КонецПроцедуры


&НаСервере
Процедура ПередЗаписьюНаСервере(Отказ, ТекущийОбъект, ПараметрыЗаписи)
	Если НЕ ЗначениеЗаполнено(РегистрСведенийМенеджерЗаписи.Статус) Тогда
		//РегистрСведенийМенеджерЗаписи.Удалить();
	// Если поменяли дату, то тогда новая  запись
	ИначеЕсли ПериодПриОткрытии <> РегистрСведенийМенеджерЗаписи.Период Тогда
		// Если что-то поменяли тогда запишем 
		Если ДатаВыдачиПриОткрытии <> РегистрСведенийМенеджерЗаписи.ДатаВыдачи ИЛИ
			СтатусПриОткрытии <> РегистрСведенийМенеджерЗаписи.Статус ИЛИ
			НомерУдостоверенияПриОткрытии <> РегистрСведенийМенеджерЗаписи.НомерУдостоверения ИЛИ
			СерияУдостоверенияПриОткрытии <> РегистрСведенийМенеджерЗаписи.СерияУдостоверения Тогда
			Если ЗначениеЗаполнено(СтатусПриОткрытии) Тогда
				МенеджерЗаписи = РегистрыСведений.СведенияОФизлицахУчастникахВОВ.СоздатьМенеджерЗаписи();
				МенеджерЗаписи.Период   = ПериодПриОткрытии;
				МенеджерЗаписи.ФизЛицо  = ФизЛицоПриОткрытии;
				МенеджерЗаписи.ДатаВыдачи	 	  = ДатаВыдачиПриОткрытии;
				МенеджерЗаписи.Статус			  = СтатусПриОткрытии;
				МенеджерЗаписи.НомерУдостоверения = НомерУдостоверенияПриОткрытии;
				МенеджерЗаписи.СерияУдостоверения = СерияУдостоверенияПриОткрытии;
				МенеджерЗаписи.Записать();
			КонецЕсли;
		КонецЕсли;
	КонецЕсли;
	ПериодПриОткрытии             = РегистрСведенийМенеджерЗаписи.Период;
	ДатаВыдачиПриОткрытии 		  = РегистрСведенийМенеджерЗаписи.ДатаВыдачи;
	СтатусПриОткрытии		  	  = РегистрСведенийМенеджерЗаписи.Статус;
	НомерУдостоверенияПриОткрытии = РегистрСведенийМенеджерЗаписи.НомерУдостоверения;
	СерияУдостоверенияПриОткрытии = РегистрСведенийМенеджерЗаписи.СерияУдостоверения;

КонецПроцедуры

